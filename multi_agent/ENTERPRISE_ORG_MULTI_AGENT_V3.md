# ZeroClaw å¤š Agent é›†ç¾¤æ¶æ„æ–¹æ¡ˆ v3.0 - ä¼ä¸šç»„ç»‡æ¨¡å¼

> **ç‰ˆæœ¬**: v3.0 - ä¼ä¸šç»„ç»‡æ¨¡å¼
> **åˆ›å»ºæ—¥æœŸ**: 2026 å¹´ 2 æœˆ 28 æ—¥
> **ä¼˜å…ˆçº§**: P0 - æ ¸å¿ƒèƒ½åŠ›
> **çŠ¶æ€**: å¾…å®¡æ‰¹
> **æ ¸å¿ƒç†å¿µ**: ä¼ä¸šç»„ç»‡æ¶æ„ï¼ˆè‘£äº‹é•¿â†’CEOâ†’é¡¹ç›®è´Ÿè´£äººâ†’Worker Agentï¼‰

---

## ä¸€ã€æ ¸å¿ƒæ„¿æ™¯

### 1.1 ç”¨æˆ·è§’è‰²å®šä½

**ç”¨æˆ· = æŠ•èµ„äºº/è‘£äº‹é•¿**
- æ‹¥æœ‰å¤šå®¶å…¬å¸ï¼ˆå¤šä¸ª ZeroClaw å®ä¾‹ï¼‰
- åªä¸ CEO ç›´æ¥æ²Ÿé€š
- å¯ä»¥æŸ¥çœ‹å…¬å¸è¿è¥çŠ¶å†µï¼ˆé¡¹ç›®åˆ—è¡¨ã€èµ„æºä½¿ç”¨ã€äº§å‡ºæŠ¥å‘Šï¼‰
- é‡å¤§å†³ç­–å®¡æ‰¹ï¼ˆè¶…é¢„ç®—ã€æ¨¡å¼åˆ‡æ¢ï¼‰

### 1.2 ç»„ç»‡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        é›†ç¾¤å±‚ (Swarm)                            â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    è‘£äº‹é•¿ (ç”¨æˆ·)                          â”‚    â”‚
â”‚  â”‚              - æ‹¥æœ‰å¤šå®¶"å…¬å¸"ï¼ˆå®ä¾‹ï¼‰                      â”‚    â”‚
â”‚  â”‚              - åªä¸ CEO ç›´æ¥æ²Ÿé€š                          â”‚    â”‚
â”‚  â”‚              - æŸ¥çœ‹å…¬å¸æŠ¥å‘Š/å®¡æ‰¹é‡å¤§å†³ç­–                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â”‚                                   â”‚
â”‚                              â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              CEO (å®ä¾‹ç®¡ç† Agent)                         â”‚    â”‚
â”‚  â”‚              - ç»‘å®šç”¨æˆ·ç»ˆç«¯ï¼ˆTelegram ç­‰ï¼‰                 â”‚    â”‚
â”‚  â”‚              - ç†è§£è‘£äº‹é•¿éœ€æ±‚                            â”‚    â”‚
â”‚  â”‚              - å†³å®šï¼šè‡ªå·±åš/åˆ›å»ºç®€å• Agent/åˆ›å»ºé¡¹ç›®å›¢é˜Ÿ    â”‚    â”‚
â”‚  â”‚              - ç®¡ç†èµ„æºé…é¢å’Œæ¨¡å¼åº“                       â”‚    â”‚
â”‚  â”‚              - å®¡æ‰¹å›¢é˜Ÿè´Ÿè´£äººçš„èµ„æºç”³è¯·                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å›¢é˜Ÿå±‚ (Team)                             â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ é¡¹ç›® 1       â”‚  â”‚ é¡¹ç›® 2       â”‚  â”‚ é¡¹ç›® N       â”‚             â”‚
â”‚  â”‚ å¸‚åœºè°ƒç ”    â”‚  â”‚ äº§å“å¼€å‘    â”‚  â”‚ ä¸“å®¶ä¼šè¯Š    â”‚             â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚             â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚             â”‚
â”‚  â”‚ â”‚è´Ÿè´£äºº  â”‚ â”‚  â”‚ â”‚è´Ÿè´£äºº  â”‚ â”‚  â”‚ â”‚è´Ÿè´£äºº  â”‚ â”‚             â”‚
â”‚  â”‚ â”‚(ä¸»Agent)â”‚ â”‚  â”‚ â”‚(ä¸»Agent)â”‚ â”‚  â”‚ â”‚(ä¸»Agent)â”‚ â”‚             â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚             â”‚
â”‚  â”‚      â”‚      â”‚  â”‚      â”‚      â”‚  â”‚      â”‚      â”‚             â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â” â”‚             â”‚
â”‚  â”‚ â”‚Worker  â”‚ â”‚  â”‚ â”‚Worker  â”‚ â”‚  â”‚ â”‚Worker  â”‚ â”‚             â”‚
â”‚  â”‚ â”‚Agents  â”‚ â”‚  â”‚ â”‚Agents  â”‚ â”‚  â”‚ â”‚Agents  â”‚ â”‚             â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                  â”‚
â”‚  å›¢é˜Ÿè´Ÿè´£äººèŒè´£ï¼š                                                â”‚
â”‚  - åŠ¨æ€ç”Ÿæˆ Worker Agent å®šä¹‰ï¼ˆè¯¦ç»†è§’è‰²èŒè´£ï¼‰                     â”‚
â”‚  - å†³å®šå›¢é˜Ÿè§„æ¨¡å’Œç»“æ„                                           â”‚
â”‚  - åè°ƒ Worker Agent åˆä½œ                                        â”‚
â”‚  - å‘ CEO ç”³è¯·èµ„æºè°ƒæ•´                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä¸ªä½“å±‚ (Agent)                            â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Worker Agent (åŠ¨æ€ç”Ÿæˆ)                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ è¯¦ç»†è§’è‰²å®šä¹‰ï¼ˆç”±å›¢é˜Ÿè´Ÿè´£äººç”Ÿæˆï¼‰                    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ - è§’è‰²åç§°å’ŒèŒè´£æè¿°ï¼ˆ200+å­—ï¼‰                     â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ - å·¥ä½œæµç¨‹å’Œåä½œåè®®                              â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ - å¯ç”¨å·¥å…·åˆ—è¡¨å’Œè°ƒç”¨è§„èŒƒ                          â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ - è¾“å‡ºè´¨é‡æ ‡å‡†å’ŒéªŒæ”¶æ¡ä»¶                          â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ - å‡çº§/æ±‚åŠ©æœºåˆ¶                                   â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 æ ¸å¿ƒè®¾è®¡åŸåˆ™

| åŸåˆ™ | è¯´æ˜ | å®ç°æ–¹å¼ |
|------|------|---------|
| **æ™ºèƒ½å†³ç­–** | æ ¸å¿ƒç®¡ç† Agent æ™ºèƒ½å†³ç­–ï¼Œéå›ºå®šåŒ¹é… | CEO Agent + å›¢é˜Ÿè´Ÿè´£äºº Agent |
| **åŠ¨æ€ç”Ÿæˆ** | Agent å®šä¹‰ç”±ä¸» Agent åŠ¨æ€ç”Ÿæˆ | LLM ç”Ÿæˆè¯¦ç»†è§’è‰²å®šä¹‰ |
| **å¼¹æ€§è§„æ¨¡** | å›¢é˜Ÿå¤§å°ç”±å›¢é˜Ÿè´Ÿè´£äººå†³å®š | è¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´ |
| **åˆ†çº§ç®¡ç†** | è‘£äº‹é•¿â†’CEOâ†’è´Ÿè´£äººâ†’Worker | å››å±‚æ¶æ„ |
| **èµ„æºå®¡æ‰¹** | å›¢é˜Ÿå¯å‘ CEO ç”³è¯·èµ„æºè°ƒæ•´ | å®¡æ‰¹å·¥ä½œæµ |
| **ç®€å•ä¼˜å…ˆ** | ç®€å•ä»»åŠ¡ä¸å¯åŠ¨é›†ç¾¤ | CEO å†³ç­–ï¼šè‡ªå·±åš/å• Agent/é›†ç¾¤ |

---

## äºŒã€æ ¸å¿ƒ Agent è®¾è®¡

### 2.1 CEO Agentï¼ˆå®ä¾‹ç®¡ç† Agentï¼‰

**èŒè´£**: ç†è§£è‘£äº‹é•¿éœ€æ±‚ï¼Œå†³å®šæ‰§è¡Œç­–ç•¥ï¼Œç®¡ç†èµ„æºå’Œæ¨¡å¼åº“

```rust
// src/agent/ceo.rs

use serde::{Deserialize, Serialize};

/// CEO Agent - å®ä¾‹çº§åˆ«çš„ç®¡ç†è€…
pub struct CEOAgent {
    /// ç»‘å®šç”¨æˆ·ç»ˆç«¯
    pub user_channel: ChannelId,
    /// èµ„æºé…é¢ç®¡ç†
    pub resource_manager: Arc<ResourceManager>,
    /// æ¨¡å¼åº“ï¼ˆå¯åŠ¨æ€æ‰©å±•ï¼‰
    pub pattern_library: Arc<PatternLibrary>,
    /// å½“å‰é¡¹ç›®åˆ—è¡¨
    pub active_projects: DashMap<String, ProjectHandle>,
    /// å†å²å†³ç­–è®°å½•ï¼ˆç”¨äºå­¦ä¹ ï¼‰
    pub decision_history: Vec<DecisionRecord>,
}

/// CEO å†³ç­–ç»“æœ
#[derive(Clone, Serialize, Deserialize)]
pub enum CEODecision {
    /// ç®€å•ä»»åŠ¡ï¼šCEO è‡ªå·±å¤„ç†
    HandleByMyself {
        response: String,
    },
    /// åˆ›å»ºå•ä¸ª Agent å¤„ç†
    CreateSingleAgent {
        role_definition: DetailedRoleDefinition,
        task: String,
    },
    /// åˆ›å»ºé¡¹ç›®å›¢é˜Ÿ
    CreateProjectTeam {
        project_name: String,
        pattern_id: String,
        initial_quota: ResourceQuota,
        team_lead_prompt: String,
    },
    /// è½¬äº¤ç°æœ‰å›¢é˜Ÿ
    AssignToExistingProject {
        project_id: String,
        task: String,
    },
    /// éœ€è¦è‘£äº‹é•¿å®¡æ‰¹
    RequiresBoardApproval {
        reason: String,
        proposal: Value,
    },
}

/// è¯¦ç»†è§’è‰²å®šä¹‰ï¼ˆç”± CEO æˆ–å›¢é˜Ÿè´Ÿè´£äººç”Ÿæˆï¼‰
#[derive(Clone, Serialize, Deserialize)]
pub struct DetailedRoleDefinition {
    /// è§’è‰²åç§°
    pub role_name: String,
    /// è¯¦ç»†èŒè´£æè¿°ï¼ˆ200+ å­—ï¼‰
    pub detailed_responsibilities: String,
    /// å·¥ä½œæµç¨‹
    pub workflow: Vec<WorkflowStep>,
    /// å¯ç”¨å·¥å…·åŠè°ƒç”¨è§„èŒƒ
    pub tools_with_specs: Vec<ToolSpecification>,
    /// è¾“å‡ºè´¨é‡æ ‡å‡†
    pub quality_standards: Vec<QualityCriterion>,
    /// åä½œåè®®
    pub collaboration_protocol: CollaborationProtocol,
    /// å‡çº§/æ±‚åŠ©æœºåˆ¶
    pub escalation_policy: EscalationPolicy,
    /// ç³»ç»Ÿæç¤ºè¯ï¼ˆå®Œæ•´ï¼‰
    pub system_prompt: String,
}

/// å·¥ä½œæµç¨‹æ­¥éª¤
#[derive(Clone, Serialize, Deserialize)]
pub struct WorkflowStep {
    pub step_number: u8,
    pub description: String,
    pub input_requirements: Vec<String>,
    pub output_format: String,
    pub quality_check: Option<String>,
}

/// å·¥å…·è§„æ ¼ï¼ˆè¯¦ç»†è¯´æ˜ï¼‰
#[derive(Clone, Serialize, Deserialize)]
pub struct ToolSpecification {
    pub tool_name: String,
    pub description: String,
    pub usage_guidelines: Vec<String>,
    pub parameter_constraints: Vec<String>,
    pub error_handling: String,
}

/// è´¨é‡æ ‡å‡†
#[derive(Clone, Serialize, Deserialize)]
pub struct QualityCriterion {
    pub criterion: String,
    pub measurement: String,
    pub threshold: String,
}

/// å‡çº§/æ±‚åŠ©æœºåˆ¶
#[derive(Clone, Serialize, Deserialize)]
pub struct EscalationPolicy {
    /// ä½•æ—¶å‡çº§
    pub trigger_conditions: Vec<String>,
    /// å‡çº§å¯¹è±¡
    pub escalate_to: String,
    /// å‡çº§æ—¶éœ€è¦æä¾›çš„ä¿¡æ¯
    pub required_context: Vec<String>,
}

impl CEOAgent {
    /// å¤„ç†è‘£äº‹é•¿éœ€æ±‚
    pub async fn handle_board_request(&self, request: &str) -> Result<CEODecision> {
        // æ­¥éª¤ 1: ä»»åŠ¡å¤æ‚åº¦åˆ†æ
        let analysis = self.analyze_task(request).await?;
        
        // æ­¥éª¤ 2: å†³ç­–ï¼ˆç®€å•ä»»åŠ¡è‡ªå·±å¤„ç†ï¼Œå¤æ‚ä»»åŠ¡åˆ›å»ºå›¢é˜Ÿï¼‰
        if analysis.complexity < 3 {
            // ç®€å•ä»»åŠ¡ï¼šè‡ªå·±å¤„ç†æˆ–åˆ›å»ºå• Agent
            if analysis.estimated_tokens < 5000 {
                return Ok(CEODecision::HandleByMyself {
                    response: self.execute_simple_task(request).await?,
                });
            } else {
                return Ok(CEODecision::CreateSingleAgent {
                    role_definition: self.generate_specialist_role(request).await?,
                    task: request.to_string(),
                });
            }
        }
        
        // æ­¥éª¤ 3: å¤æ‚ä»»åŠ¡ï¼šé€‰æ‹©æ¨¡å¼å¹¶åˆ›å»ºé¡¹ç›®å›¢é˜Ÿ
        let pattern = self.select_pattern(request, &analysis).await?;
        let project_name = self.generate_project_name(request);
        
        // æ­¥éª¤ 4: ç”Ÿæˆå›¢é˜Ÿè´Ÿè´£äººæç¤ºè¯
        let team_lead_prompt = self.generate_team_lead_prompt(&pattern, request).await?;
        
        // æ­¥éª¤ 5: åˆ†é…åˆå§‹èµ„æºé…é¢
        let initial_quota = self.allocate_quota(&analysis, &pattern);
        
        Ok(CEODecision::CreateProjectTeam {
            project_name,
            pattern_id: pattern.id,
            initial_quota,
            team_lead_prompt,
        })
    }

    /// ç”Ÿæˆä¸“å®¶è§’è‰²å®šä¹‰ï¼ˆè¯¦ç»†ï¼‰
    async fn generate_specialist_role(&self, task: &str) -> Result<DetailedRoleDefinition> {
        // è°ƒç”¨ LLM ç”Ÿæˆè¯¦ç»†è§’è‰²å®šä¹‰
        let prompt = format!(r#"
è¯·ä¸ºä»¥ä¸‹ä»»åŠ¡ç”Ÿæˆä¸€ä¸ªä¸“å®¶è§’è‰²å®šä¹‰ï¼š

ä»»åŠ¡ï¼š{task}

è¯·ç”Ÿæˆä»¥ä¸‹å†…å®¹ï¼š
1. è§’è‰²åç§°ï¼ˆç®€æ´ä¸“ä¸šï¼‰
2. è¯¦ç»†èŒè´£æè¿°ï¼ˆ200 å­—ä»¥ä¸Šï¼Œè¯´æ˜å…·ä½“å·¥ä½œå†…å®¹ï¼‰
3. å·¥ä½œæµç¨‹ï¼ˆ3-5 ä¸ªæ­¥éª¤ï¼Œæ¯æ­¥è¯´æ˜è¾“å…¥è¾“å‡ºï¼‰
4. å¯ç”¨å·¥å…·åŠè°ƒç”¨è§„èŒƒï¼ˆæ¯ä¸ªå·¥å…·è¯´æ˜ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ï¼‰
5. è¾“å‡ºè´¨é‡æ ‡å‡†ï¼ˆ3-5 æ¡å¯è¡¡é‡çš„æ ‡å‡†ï¼‰
6. åä½œåè®®ï¼ˆå¦‚ä½•ä¸ CEO å’Œå…¶ä»– Agent æ²Ÿé€šï¼‰
7. å‡çº§/æ±‚åŠ©æœºåˆ¶ï¼ˆä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦æ±‚åŠ©ï¼Œå‘è°æ±‚åŠ©ï¼‰
8. å®Œæ•´çš„ç³»ç»Ÿæç¤ºè¯ï¼ˆå¯ç›´æ¥ç”¨äºåˆå§‹åŒ– Agentï¼‰

è¦æ±‚ï¼š
- èŒè´£æè¿°è¦å…·ä½“ï¼Œé¿å…ç©ºæ³›
- å·¥ä½œæµç¨‹è¦å¯æ‰§è¡Œ
- å·¥å…·ä½¿ç”¨è¦æœ‰æ˜ç¡®è§„èŒƒ
- è´¨é‡æ ‡å‡†è¦å¯è¡¡é‡
"#);

        let response = self.llm.generate(&prompt).await?;
        self.parse_role_definition(&response)
    }

    /// ç”Ÿæˆå›¢é˜Ÿè´Ÿè´£äººæç¤ºè¯
    async fn generate_team_lead_prompt(&self, pattern: &CollaborationPattern, task: &str) -> Result<String> {
        Ok(format!(r#"
ä½ æ˜¯"{project_name}"é¡¹ç›®çš„è´Ÿè´£äººï¼Œå‘ CEO æ±‡æŠ¥ã€‚

## é¡¹ç›®èƒŒæ™¯
{task}

## åä½œæ¨¡å¼
æ¨¡å¼åç§°ï¼š{pattern_name}
æ¨¡å¼æè¿°ï¼š{pattern_description}

## ä½ çš„èŒè´£
1. æ ¹æ®é¡¹ç›®éœ€æ±‚ï¼ŒåŠ¨æ€ç”Ÿæˆ Worker Agent çš„è¯¦ç»†è§’è‰²å®šä¹‰
2. å†³å®šå›¢é˜Ÿè§„æ¨¡å’Œç»“æ„ï¼ˆéœ€è¦å¤šå°‘ Agentï¼Œå„ä»€ä¹ˆè§’è‰²ï¼‰
3. åè°ƒ Worker Agent ä¹‹é—´çš„åˆä½œ
4. ç›‘æ§é¡¹ç›®è¿›åº¦ï¼Œç¡®ä¿æŒ‰æ—¶äº¤ä»˜
5. å¦‚é‡èµ„æºä¸è¶³ï¼Œå¯å‘ CEO ç”³è¯·è°ƒæ•´é…é¢

## ç”Ÿæˆ Worker Agent çš„è¦æ±‚
æ¯ä¸ª Worker Agent çš„å®šä¹‰å¿…é¡»åŒ…å«ï¼š
- è§’è‰²åç§°å’Œè¯¦ç»†èŒè´£ï¼ˆ200+ å­—ï¼‰
- å·¥ä½œæµç¨‹ï¼ˆ3-5 æ­¥ï¼‰
- å¯ç”¨å·¥å…·åŠè°ƒç”¨è§„èŒƒ
- è¾“å‡ºè´¨é‡æ ‡å‡†
- åä½œåè®®
- å‡çº§/æ±‚åŠ©æœºåˆ¶

## èµ„æºé…é¢
åˆå§‹é…é¢ï¼š{quota}

## æ±‡æŠ¥æœºåˆ¶
- å®šæœŸå‘ CEO æ±‡æŠ¥è¿›åº¦ï¼ˆæ¯å®Œæˆä¸€ä¸ªé‡Œç¨‹ç¢‘ï¼‰
- é‡åˆ°ä»¥ä¸‹æƒ…å†µç«‹å³æ±‡æŠ¥ï¼š
  - èµ„æºä¸è¶³éœ€è¦è¿½åŠ 
  - éœ€è¦åˆ‡æ¢åä½œæ¨¡å¼
  - é‡åˆ°æ— æ³•è§£å†³çš„æŠ€æœ¯é—®é¢˜
  - é¡¹ç›®å¯èƒ½å»¶æœŸ

ç°åœ¨ï¼Œè¯·å¼€å§‹ä½ çš„å·¥ä½œï¼š
1. åˆ†æé¡¹ç›®éœ€æ±‚
2. è®¾è®¡å›¢é˜Ÿç»“æ„
3. ç”Ÿæˆ Worker Agent å®šä¹‰
4. å¯åŠ¨é¡¹ç›®æ‰§è¡Œ
"#,
            project_name = self.generate_project_name(task),
            pattern_name = pattern.name,
            pattern_description = pattern.description,
            quota = self.format_quota(&pattern),
        ))
    }
}
```

---

### 2.2 å›¢é˜Ÿè´Ÿè´£äºº Agentï¼ˆProject Leadï¼‰

**èŒè´£**: åŠ¨æ€ç”Ÿæˆ Worker Agent å®šä¹‰ï¼Œåè°ƒå›¢é˜Ÿåˆä½œ

```rust
// src/agent/team_lead.rs

use crate::agent::ceo::DetailedRoleDefinition;

/// å›¢é˜Ÿè´Ÿè´£äºº Agent
pub struct TeamLeadAgent {
    /// é¡¹ç›®åç§°
    pub project_name: String,
    /// åä½œæ¨¡å¼
    pub pattern: CollaborationPattern,
    /// CEO åˆ†é…çš„èµ„æºé…é¢
    pub quota: ResourceQuota,
    /// Worker Agent åˆ—è¡¨
    pub workers: DashMap<String, WorkerAgent>,
    /// ä»»åŠ¡åˆ†è§£
    pub task_breakdown: Vec<SubTask>,
    /// ä¸ CEO çš„é€šä¿¡é€šé“
    pub ceo_channel: ChannelId,
}

/// Worker Agent å®ä¾‹
pub struct WorkerAgent {
    pub id: String,
    pub role_definition: DetailedRoleDefinition,
    pub status: AgentStatus,
    pub current_task: Option<SubTask>,
    pub completed_tasks: Vec<SubTask>,
}

impl TeamLeadAgent {
    /// å¯åŠ¨é¡¹ç›®ï¼šåˆ†æéœ€æ±‚ï¼Œç”Ÿæˆå›¢é˜Ÿç»“æ„
    pub async fn kickoff(&self, project_brief: &str) -> Result<ProjectPlan> {
        // æ­¥éª¤ 1: é¡¹ç›®éœ€æ±‚åˆ†æ
        let analysis = self.analyze_project(project_brief).await?;
        
        // æ­¥éª¤ 2: è®¾è®¡å›¢é˜Ÿç»“æ„ï¼ˆåŠ¨æ€å†³å®šéœ€è¦å“ªäº›è§’è‰²ï¼‰
        let team_structure = self.design_team_structure(&analysis).await?;
        
        // æ­¥éª¤ 3: ä¸ºæ¯ä¸ªè§’è‰²ç”Ÿæˆè¯¦ç»†çš„ Worker Agent å®šä¹‰
        let mut worker_definitions = Vec::new();
        for role in &team_structure.roles {
            let definition = self.generate_worker_definition(role, &analysis).await?;
            worker_definitions.push(definition);
        }
        
        // æ­¥éª¤ 4: ä»»åŠ¡åˆ†è§£
        let tasks = self.breakdown_tasks(project_brief, &team_structure).await?;
        
        // æ­¥éª¤ 5: å‘ CEO æ±‡æŠ¥è®¡åˆ’ï¼ˆå¯é€‰ï¼Œæ ¹æ®æ¨¡å¼è¦æ±‚ï¼‰
        if self.pattern.requires_ceo_approval {
            self.report_to_ceo(&ProjectPlan {
                team_structure: team_structure.clone(),
                worker_definitions: worker_definitions.clone(),
                tasks: tasks.clone(),
                estimated_completion: self.estimate_completion(&tasks),
            }).await?;
        }
        
        // æ­¥éª¤ 6: åˆ›å»º Worker Agent å®ä¾‹
        for definition in &worker_definitions {
            let worker = self.spawn_worker(definition).await?;
            self.workers.insert(worker.id.clone(), worker);
        }
        
        // æ­¥éª¤ 7: åˆ†é…ä»»åŠ¡å¹¶å¯åŠ¨æ‰§è¡Œ
        self.assign_and_start_tasks(&tasks).await?;
        
        Ok(ProjectPlan {
            team_structure,
            worker_definitions,
            tasks,
            estimated_completion: self.estimate_completion(&tasks),
        })
    }

    /// ç”Ÿæˆ Worker Agent è¯¦ç»†å®šä¹‰ï¼ˆæ ¸å¿ƒæ–¹æ³•ï¼‰
    async fn generate_worker_definition(
        &self,
        role: &TeamRole,
        analysis: &ProjectAnalysis,
    ) -> Result<DetailedRoleDefinition> {
        let prompt = format!(r#"
ä½ æ˜¯"{project_name}"é¡¹ç›®çš„å›¢é˜Ÿè´Ÿè´£äººï¼Œéœ€è¦ä¸ºå›¢é˜Ÿæˆå‘˜ç”Ÿæˆè¯¦ç»†çš„è§’è‰²å®šä¹‰ã€‚

## é¡¹ç›®ä¿¡æ¯
é¡¹ç›®åç§°ï¼š{project_name}
é¡¹ç›®æè¿°ï¼š{project_brief}
é¡¹ç›®ç±»å‹ï¼š{project_type}
é¢„è®¡è§„æ¨¡ï¼š{scale}

## éœ€è¦å®šä¹‰çš„è§’è‰²
è§’è‰²åç§°ï¼š{role_name}
è§’è‰²æ¦‚è¿°ï¼š{role_overview}

## è¯·ç”Ÿæˆå®Œæ•´çš„è§’è‰²å®šä¹‰

### 1. è§’è‰²åç§°
ï¼ˆç®€æ´ä¸“ä¸šçš„åç§°ï¼‰

### 2. è¯¦ç»†èŒè´£æè¿°
ï¼ˆ200 å­—ä»¥ä¸Šï¼Œå…·ä½“è¯´æ˜ï¼š
- è¿™ä¸ªè§’è‰²çš„æ ¸å¿ƒèŒè´£æ˜¯ä»€ä¹ˆ
- åœ¨é¡¹ç›®ä¸­çš„å®šä½å’Œä»·å€¼
- éœ€è¦å®Œæˆçš„å…·ä½“å·¥ä½œå†…å®¹
- ä¸å…¶ä»–è§’è‰²çš„åä½œå…³ç³»
ï¼‰

### 3. å·¥ä½œæµç¨‹
ï¼ˆ3-5 ä¸ªæ­¥éª¤ï¼Œæ¯æ­¥è¯´æ˜ï¼š
- æ­¥éª¤ç¼–å·å’Œåç§°
- è¾“å…¥è¦æ±‚ï¼ˆéœ€è¦ä»€ä¹ˆä¿¡æ¯/èµ„æºï¼‰
- å…·ä½“æ“ä½œ
- è¾“å‡ºæ ¼å¼ï¼ˆäº¤ä»˜ä»€ä¹ˆæˆæœï¼‰
- è´¨é‡æ£€æŸ¥ç‚¹ï¼ˆå¦‚ä½•ç¡®è®¤å®Œæˆè´¨é‡ï¼‰
ï¼‰

### 4. å¯ç”¨å·¥å…·åŠè°ƒç”¨è§„èŒƒ
ï¼ˆé’ˆå¯¹æ¯ä¸ªå·¥å…·è¯´æ˜ï¼š
- å·¥å…·åç§°
- ä½¿ç”¨åœºæ™¯ï¼ˆä»€ä¹ˆæ—¶å€™ç”¨ï¼‰
- è°ƒç”¨è§„èŒƒï¼ˆå‚æ•°è¦æ±‚ã€æ ¼å¼è¦æ±‚ï¼‰
- æ³¨æ„äº‹é¡¹ï¼ˆå¸¸è§é”™è¯¯ã€é™åˆ¶æ¡ä»¶ï¼‰
- é”™è¯¯å¤„ç†ï¼ˆå‡ºé”™äº†æ€ä¹ˆåŠï¼‰
ï¼‰

å¯ç”¨å·¥å…·åˆ—è¡¨ï¼š{available_tools}

### 5. è¾“å‡ºè´¨é‡æ ‡å‡†
ï¼ˆ3-5 æ¡å¯è¡¡é‡çš„æ ‡å‡†ï¼Œä¾‹å¦‚ï¼š
- ä»£ç è¦†ç›–ç‡ > 80%
- æ–‡æ¡£å®Œæ•´åº¦ï¼šåŒ…å« API è¯´æ˜ã€ä½¿ç”¨ç¤ºä¾‹ã€æ³¨æ„äº‹é¡¹
- å“åº”æ—¶é—´ < 2 ç§’
ï¼‰

### 6. åä½œåè®®
ï¼ˆè¯´æ˜ï¼š
- å¦‚ä½•æ¥æ”¶ä»»åŠ¡ï¼ˆä»è°é‚£é‡Œï¼Œä»€ä¹ˆæ ¼å¼ï¼‰
- å¦‚ä½•æ±‡æŠ¥è¿›åº¦ï¼ˆé¢‘ç‡ã€æ ¼å¼ã€å†…å®¹ï¼‰
- å¦‚ä½•è¯·æ±‚å¸®åŠ©ï¼ˆä»€ä¹ˆæƒ…å†µã€å‘è°ã€æä¾›ä»€ä¹ˆä¿¡æ¯ï¼‰
- å¦‚ä½•äº¤ä»˜æˆæœï¼ˆæ ¼å¼ã€éªŒæ”¶æµç¨‹ï¼‰
ï¼‰

### 7. å‡çº§/æ±‚åŠ©æœºåˆ¶
ï¼ˆæ˜ç¡®è¯´æ˜ï¼š
- ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦å‡çº§ï¼ˆæŠ€æœ¯éš¾é¢˜ã€èµ„æºä¸è¶³ã€éœ€æ±‚å˜æ›´ç­‰ï¼‰
- å‘è°å‡çº§ï¼ˆå›¢é˜Ÿè´Ÿè´£äºº/CEOï¼‰
- å‡çº§æ—¶éœ€è¦æä¾›çš„ä¿¡æ¯ï¼ˆé—®é¢˜æè¿°ã€å·²å°è¯•æ–¹æ¡ˆã€éœ€è¦çš„æ”¯æŒï¼‰
- å‡çº§å“åº”æ—¶é—´é¢„æœŸ
ï¼‰

### 8. å®Œæ•´ç³»ç»Ÿæç¤ºè¯
ï¼ˆå°†ä»¥ä¸Šå†…å®¹æ•´åˆä¸ºä¸€æ®µå¯ç›´æ¥ç”¨äºåˆå§‹åŒ– Agent çš„ç³»ç»Ÿæç¤ºè¯ï¼Œ
è¯­æ°”ä¸“ä¸šä½†å‹å¥½ï¼Œç»“æ„æ¸…æ™°ï¼Œä¾¿äº Agent ç†è§£å’Œæ‰§è¡Œï¼‰

## è¾“å‡ºè¦æ±‚
- ä½¿ç”¨ JSON æ ¼å¼è¾“å‡º
- æ¯ä¸ªéƒ¨åˆ†éƒ½è¦è¯¦ç»†å…·ä½“ï¼Œé¿å…ç©ºæ³›
- å·¥ä½œæµç¨‹è¦å¯æ‰§è¡Œ
- è´¨é‡æ ‡å‡†è¦å¯è¡¡é‡
"#,
            project_name = self.project_name,
            project_brief = analysis.brief,
            project_type = analysis.task_type,
            scale = analysis.estimated_scale,
            role_name = role.name,
            role_overview = role.overview,
            available_tools = self.format_available_tools(&role.allowed_tools),
        );

        let response = self.llm.generate(&prompt).await?;
        self.parse_role_definition(&response)
    }

    /// ç”³è¯·èµ„æºè°ƒæ•´
    pub async fn request_quota_adjustment(&self, request: &QuotaAdjustmentRequest) -> Result<()> {
        let message = format!(r#"
CEO æ‚¨å¥½ï¼Œæˆ‘æ˜¯"{project_name}"é¡¹ç›®è´Ÿè´£äººã€‚

## å½“å‰çŠ¶å†µ
- å·²å®Œæˆï¼š{completed_percentage}%
- å½“å‰é˜¶æ®µï¼š{current_phase}
- å›¢é˜Ÿè§„æ¨¡ï¼š{current_agents} ä¸ª Agent

## èµ„æºç”³è¯·
ç”³è¯·ç±»å‹ï¼š{request_type}
å½“å‰é…é¢ï¼š{current_quota}
ç”³è¯·é…é¢ï¼š{requested_quota}
ç”³è¯·åŸå› ï¼š{reason}

## é¡¹ç›®è¿›å±•
{progress_summary}

## é¢„æœŸå½±å“
å¦‚æ‰¹å‡†ï¼š{expected_benefit}
å¦‚ä¸æ‰¹å‡†ï¼š{risk_if_denied}

è¯·å®¡æ‰¹ï¼Œè°¢è°¢ã€‚
"#,
            project_name = self.project_name,
            completed_percentage = self.get_completion_percentage(),
            current_phase = self.get_current_phase(),
            current_agents = self.workers.len(),
            request_type = request.request_type,
            current_quota = self.format_quota(&self.quota),
            requested_quota = self.format_quota(&request.new_quota),
            reason = request.reason,
            progress_summary = self.get_progress_summary(),
            expected_benefit = request.expected_benefit,
            risk_if_denied = request.risk_if_denied,
        );

        self.send_to_ceo(&message).await
    }
}
```

---

### 2.3 Worker Agentï¼ˆæ‰§è¡Œ Agentï¼‰

**ç‰¹ç‚¹**: ç”±å›¢é˜Ÿè´Ÿè´£äººåŠ¨æ€ç”Ÿæˆè¯¦ç»†å®šä¹‰

```rust
// src/agent/worker.rs

use crate::agent::ceo::DetailedRoleDefinition;

/// Worker Agent - å…·ä½“æ‰§è¡Œä»»åŠ¡çš„ Agent
pub struct WorkerAgent {
    pub id: String,
    /// è¯¦ç»†è§’è‰²å®šä¹‰ï¼ˆç”±å›¢é˜Ÿè´Ÿè´£äººç”Ÿæˆï¼‰
    pub role_definition: DetailedRoleDefinition,
    /// å½“å‰çŠ¶æ€
    pub status: AgentStatus,
    /// å½“å‰ä»»åŠ¡
    pub current_task: Option<SubTask>,
    /// æ²™ç®±ç¯å¢ƒ
    pub sandbox: SandboxHandle,
    /// MCP å·¥å…·å®¢æˆ·ç«¯
    pub mcp_client: MCPClient,
}

impl WorkerAgent {
    /// åˆå§‹åŒ–ï¼ˆä½¿ç”¨å›¢é˜Ÿè´Ÿè´£äººç”Ÿæˆçš„è¯¦ç»†å®šä¹‰ï¼‰
    pub async fn initialize(&self) -> Result<()> {
        // ä½¿ç”¨å®Œæ•´çš„ç³»ç»Ÿæç¤ºè¯åˆå§‹åŒ–
        let system_prompt = &self.role_definition.system_prompt;
        
        // åˆå§‹åŒ– LLM ä¼šè¯
        self.llm.init_with_system_prompt(system_prompt).await?;
        
        // æŒ‚è½½å·¥å…·
        for tool_spec in &self.role_definition.tools_with_specs {
            self.mcp_client.register_tool(tool_spec).await?;
        }
        
        // å‘å›¢é˜Ÿè´Ÿè´£äººæŠ¥åˆ°
        self.report_to_lead("å·²åˆå§‹åŒ–ï¼Œå‡†å¤‡æ¥æ”¶ä»»åŠ¡").await?;
        
        Ok(())
    }

    /// æ‰§è¡Œä»»åŠ¡
    pub async fn execute_task(&self, task: &SubTask) -> Result<TaskResult> {
        // æ£€æŸ¥ä»»åŠ¡æ˜¯å¦ç¬¦åˆè§’è‰²èŒè´£
        if !self.is_task_in_scope(task) {
            return Err("ä»»åŠ¡è¶…å‡ºè§’è‰²èŒè´£èŒƒå›´".into());
        }

        // æŒ‰ç…§å·¥ä½œæµç¨‹æ‰§è¡Œ
        let mut result = TaskResult::new();
        for step in &self.role_definition.workflow {
            let step_result = self.execute_workflow_step(step, task).await?;
            result.steps.push(step_result);
            
            // è´¨é‡æ£€æŸ¥
            if let Some(check) = &step.quality_check {
                if !self.verify_quality(&step_result, check).await? {
                    // è´¨é‡ä¸è¾¾æ ‡ï¼Œé‡è¯•æˆ–å‡çº§
                    return self.handle_quality_failure(step, &step_result).await;
                }
            }
        }

        // äº¤ä»˜æˆæœ
        self.deliver_result(&result).await?;
        
        Ok(result)
    }

    /// è¯·æ±‚å¸®åŠ©ï¼ˆè§¦å‘å‡çº§æœºåˆ¶ï¼‰
    pub async fn request_help(&self, issue: &str) -> Result<()> {
        // æ£€æŸ¥æ˜¯å¦ç¬¦åˆå‡çº§æ¡ä»¶
        let should_escalate = self.role_definition.escalation_policy
            .trigger_conditions
            .iter()
            .any(|condition| self.matches_condition(issue, condition));

        if should_escalate {
            // å‘å›¢é˜Ÿè´Ÿè´£äººå‡çº§
            self.escalate_to_lead(issue).await?;
        } else {
            // å°è¯•è‡ªå·±è§£å†³æˆ–è¯¢é—®åŒäº‹
            self.try_self_resolve(issue).await?;
        }

        Ok(())
    }
}
```

---

## ä¸‰ã€ä»»åŠ¡å†³ç­–æµç¨‹

### 3.1 CEO å†³ç­–æ ‘

```
ç”¨æˆ·ä»»åŠ¡
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CEO åˆ†æä»»åŠ¡     â”‚
â”‚ - å¤æ‚åº¦è¯„åˆ†    â”‚
â”‚ - é¢„ä¼° Token æ•°   â”‚
â”‚ - æ‰€éœ€é¢†åŸŸçŸ¥è¯†  â”‚
â”‚ - æ—¶é—´æ•æ„Ÿæ€§    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚ç®€å•  â”‚  â”‚å¤æ‚  â”‚
â”‚<3 åˆ† â”‚  â”‚â‰¥3 åˆ† â”‚
â””â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”˜
   â”‚         â”‚
   â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Token<5K â”‚ â”‚é€‰æ‹©åä½œæ¨¡å¼   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚- å¹¿æ’’ç½‘       â”‚
     â”‚      â”‚- åˆ†å±‚å®¡æ‰¹     â”‚
     â–¼      â”‚- ä¸“å®¶ä¼šè¯Š     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚- æ··åˆä¼—åŒ…     â”‚
â”‚CEO è‡ªå·±  â”‚ â”‚- åŠ¨æ€è‡ªé€‚åº”   â”‚
â”‚å¤„ç†     â”‚ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ç”Ÿæˆå›¢é˜Ÿè´Ÿè´£äººâ”‚
            â”‚æç¤ºè¯        â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚åˆ›å»ºé¡¹ç›®å›¢é˜Ÿ  â”‚
            â”‚åˆ†é…åˆå§‹é…é¢  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 å›¢é˜Ÿè´Ÿè´£äººå†³ç­–æ ‘

```
é¡¹ç›®ä»»åŠ¡
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚å›¢é˜Ÿè´Ÿè´£äººåˆ†æ   â”‚
â”‚- ä»»åŠ¡åˆ†è§£       â”‚
â”‚- æ‰€éœ€è§’è‰²       â”‚
â”‚- å·¥ä½œé‡è¯„ä¼°     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚è®¾è®¡å›¢é˜Ÿç»“æ„     â”‚
â”‚- éœ€è¦å“ªäº›è§’è‰²   â”‚
â”‚- æ¯ä¸ªè§’è‰²å‡ äºº   â”‚
â”‚- åä½œæµç¨‹       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ä¸ºæ¯ä¸ªè§’è‰²ç”Ÿæˆ    â”‚
â”‚è¯¦ç»† Worker å®šä¹‰   â”‚
â”‚(è°ƒç”¨ LLM)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚åˆ›å»º Worker Agent â”‚
â”‚å®ä¾‹             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚åˆ†é…ä»»åŠ¡å¹¶å¯åŠ¨   â”‚
â”‚æ‰§è¡Œ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€è¯¦ç»†è§’è‰²å®šä¹‰ç¤ºä¾‹

### 4.1 ç¤ºä¾‹ï¼šå¸‚åœºè°ƒç ” Worker Agent

```json
{
  "role_name": "é«˜çº§å¸‚åœºç ”ç©¶åˆ†æå¸ˆ",
  "detailed_responsibilities": "ä½ æ˜¯ä¸€åèµ„æ·±å¸‚åœºç ”ç©¶åˆ†æå¸ˆï¼Œä¸“æ³¨äºç§‘æŠ€è¡Œä¸šçš„å¸‚åœºæƒ…æŠ¥æ”¶é›†å’Œåˆ†æã€‚ä½ çš„æ ¸å¿ƒèŒè´£åŒ…æ‹¬ï¼š1) é€šè¿‡å¤šç§æ¸ é“ï¼ˆç½‘ç»œæœç´¢ã€è¡Œä¸šæŠ¥å‘Šã€ç¤¾äº¤åª’ä½“ï¼‰æ”¶é›†ç›®æ ‡å¸‚åœºçš„ä¿¡æ¯ï¼›2) åˆ†æå¸‚åœºè§„æ¨¡ã€å¢é•¿è¶‹åŠ¿ã€ç«äº‰æ ¼å±€ï¼›3) è¯†åˆ«å…³é”®å¸‚åœºå‚ä¸è€…å’Œä»–ä»¬çš„ç­–ç•¥ï¼›4) å‘ç°å¸‚åœºæœºä¼šå’Œæ½œåœ¨é£é™©ï¼›5) å°†æ”¶é›†çš„ä¿¡æ¯æ•´ç†æˆç»“æ„åŒ–çš„ç ”ç©¶æŠ¥å‘Šã€‚ä½ éœ€è¦ç¡®ä¿ä¿¡æ¯çš„å‡†ç¡®æ€§ã€æ—¶æ•ˆæ€§å’Œç›¸å…³æ€§ï¼Œä¸ºé¡¹ç›®å†³ç­–æä¾›å¯é çš„æ•°æ®æ”¯æŒã€‚",
  "workflow": [
    {
      "step_number": 1,
      "description": "éœ€æ±‚ç†è§£å’Œæœç´¢ç­–ç•¥åˆ¶å®š",
      "input_requirements": ["ç ”ç©¶ä¸»é¢˜", "ç›®æ ‡å¸‚åœº", "å…³é”®é—®é¢˜åˆ—è¡¨"],
      "output_format": "æœç´¢è®¡åˆ’æ–‡æ¡£ï¼ŒåŒ…å«å…³é”®è¯åˆ—è¡¨ã€ç›®æ ‡ç½‘ç«™åˆ—è¡¨ã€é¢„æœŸè¾“å‡º",
      "quality_check": "æœç´¢è®¡åˆ’éœ€è¦†ç›–è‡³å°‘ 5 ä¸ªä¿¡æ¯æºï¼Œå…³é”®è¯ä¸å°‘äº 10 ä¸ª"
    },
    {
      "step_number": 2,
      "description": "ä¿¡æ¯æ”¶é›†",
      "input_requirements": ["æœç´¢è®¡åˆ’"],
      "output_format": "åŸå§‹ä¿¡æ¯é›†åˆï¼ˆURLã€æ ‡é¢˜ã€æ‘˜è¦ã€å‘å¸ƒæ—¶é—´ï¼‰",
      "quality_check": "æ”¶é›†ä¸å°‘äº 50 æ¡ç›¸å…³ä¿¡æ¯ï¼Œæ—¶é—´èŒƒå›´åœ¨æœ€è¿‘ 2 å¹´å†…"
    },
    {
      "step_number": 3,
      "description": "ä¿¡æ¯ç­›é€‰å’ŒéªŒè¯",
      "input_requirements": ["åŸå§‹ä¿¡æ¯é›†åˆ"],
      "output_format": "ç­›é€‰åçš„ä¿¡æ¯åˆ—è¡¨ï¼ˆå¸¦å¯ä¿¡åº¦è¯„åˆ†ï¼‰",
      "quality_check": "å‰”é™¤é‡å¤å’Œä¸å¯é æ¥æºï¼Œä¿ç•™è‡³å°‘ 30 æ¡é«˜è´¨é‡ä¿¡æ¯"
    },
    {
      "step_number": 4,
      "description": "åˆ†æå’Œç»¼åˆ",
      "input_requirements": ["ç­›é€‰åçš„ä¿¡æ¯åˆ—è¡¨"],
      "output_format": "åˆ†ææŠ¥å‘Šè‰ç¨¿ï¼ˆåŒ…å«å¸‚åœºè§„æ¨¡ã€è¶‹åŠ¿ã€ç«äº‰æ ¼å±€ï¼‰",
      "quality_check": "æŠ¥å‘Šéœ€åŒ…å«æ•°æ®æ”¯æ’‘çš„ç»“è®ºï¼Œæ¯ä¸ªç»“è®ºè‡³å°‘ 2 ä¸ªæ¥æº"
    },
    {
      "step_number": 5,
      "description": "æŠ¥å‘Šå®šç¨¿",
      "input_requirements": ["åˆ†ææŠ¥å‘Šè‰ç¨¿", "å›¢é˜Ÿåé¦ˆ"],
      "output_format": "æœ€ç»ˆç ”ç©¶æŠ¥å‘Šï¼ˆMarkdown æ ¼å¼ï¼‰",
      "quality_check": "é€šè¿‡å›¢é˜Ÿè´Ÿè´£äººå®¡æ ¸ï¼Œæ ¼å¼è§„èŒƒï¼Œæ•°æ®å‡†ç¡®"
    }
  ],
  "tools_with_specs": [
    {
      "tool_name": "web_search",
      "description": "ç½‘ç»œæœç´¢å¼•æ“ï¼Œç”¨äºæŸ¥æ‰¾ç›¸å…³ä¿¡æ¯",
      "usage_guidelines": [
        "ç”¨äºæŸ¥æ‰¾å¸‚åœºæŠ¥å‘Šã€è¡Œä¸šæ–°é—»ã€å…¬å¸ä¿¡æ¯",
        "æ¯æ¬¡æœç´¢ä½¿ç”¨ 3-5 ä¸ªå…³é”®è¯ç»„åˆ",
        "ä¼˜å…ˆä½¿ç”¨è‹±æ–‡æœç´¢è·å–å›½é™…è§†é‡"
      ],
      "parameter_constraints": [
        "query å‚æ•°ä¸è¶…è¿‡ 100 å­—ç¬¦",
        "num_results å»ºè®®è®¾ç½®ä¸º 10-20",
        "time_range å»ºè®®è®¾ç½®ä¸º'year'è·å–æœ€æ–°ä¿¡æ¯"
      ],
      "error_handling": "å¦‚æœç´¢ç»“æœä¸ç†æƒ³ï¼Œå°è¯•æ›´æ¢å…³é”®è¯æˆ–æœç´¢å¹³å°"
    },
    {
      "tool_name": "web_fetch",
      "description": "ç½‘é¡µå†…å®¹æŠ“å–ï¼Œç”¨äºè·å–è¯¦ç»†ä¿¡æ¯",
      "usage_guidelines": [
        "ç”¨äºè·å–æœç´¢ç»“æœçš„è¯¦ç»†å†…å®¹",
        "ä¼˜å…ˆæŠ“å–å®˜æ–¹æŠ¥å‘Šã€æƒå¨åª’ä½“",
        "æ³¨æ„ç‰ˆæƒå’Œå¼•ç”¨è§„èŒƒ"
      ],
      "parameter_constraints": [
        "url å¿…é¡»æ˜¯ http/https å¼€å¤´",
        "max_size å»ºè®®è®¾ç½®ä¸º 500KB",
        "timeout è®¾ç½®ä¸º 30 ç§’"
      ],
      "error_handling": "å¦‚ç½‘é¡µæ— æ³•è®¿é—®ï¼Œè®°å½•å¹¶å°è¯•å…¶ä»–æ¥æº"
    },
    {
      "tool_name": "memory_recall",
      "description": "æŸ¥è¯¢å†…éƒ¨è®°å¿†ï¼Œè·å–å†å²é¡¹ç›®ä¿¡æ¯",
      "usage_guidelines": [
        "ç”¨äºæŸ¥æ‰¾ç±»ä¼¼é¡¹ç›®çš„å†å²æ•°æ®",
        "é¿å…é‡å¤å·¥ä½œ",
        "å¼•ç”¨å†å²ä¿¡æ¯éœ€æ³¨æ˜æ¥æº"
      ],
      "parameter_constraints": [
        "query éœ€å…·ä½“æ˜ç¡®",
        "max_results å»ºè®®è®¾ç½®ä¸º 5-10"
      ],
      "error_handling": "å¦‚æ— ç›¸å…³è®°å¿†ï¼Œç»§ç»­å¤–éƒ¨æœç´¢"
    }
  ],
  "quality_standards": [
    "ä¿¡æ¯å‡†ç¡®æ€§ï¼šæ‰€æœ‰æ•°æ®éœ€æœ‰æ˜ç¡®æ¥æºï¼Œå…³é”®æ•°æ®éœ€äº¤å‰éªŒè¯",
    "æ—¶æ•ˆæ€§ï¼š80% ä»¥ä¸Šçš„ä¿¡æ¯åº”åœ¨æœ€è¿‘ 2 å¹´å†…å‘å¸ƒ",
    "å®Œæ•´æ€§ï¼šæŠ¥å‘Šéœ€è¦†ç›–å¸‚åœºè§„æ¨¡ã€å¢é•¿è¶‹åŠ¿ã€ç«äº‰æ ¼å±€ã€æœºä¼šé£é™©å››ä¸ªç»´åº¦",
    "å¯è¯»æ€§ï¼šæŠ¥å‘Šç»“æ„æ¸…æ™°ï¼Œä½¿ç”¨å›¾è¡¨è¾…åŠ©è¯´æ˜ï¼Œå­—æ•° 3000-5000 å­—"
  ],
  "collaboration_protocol": {
    "task_reception": "ä»å›¢é˜Ÿè´Ÿè´£äººæ¥æ”¶ä»»åŠ¡ï¼Œä»»åŠ¡æ ¼å¼ä¸º JSONï¼ŒåŒ…å«ç ”ç©¶ä¸»é¢˜ã€å…³é”®é—®é¢˜ã€æˆªæ­¢æ—¶é—´",
    "progress_reporting": "æ¯å®Œæˆä¸€ä¸ªå·¥ä½œæµæ­¥éª¤ï¼Œå‘å›¢é˜Ÿè´Ÿè´£äººå‘é€è¿›åº¦æ›´æ–°ï¼ˆæ­¥éª¤ç¼–å·ã€å®ŒæˆçŠ¶æ€ã€é‡åˆ°çš„é—®é¢˜ï¼‰",
    "help_request": "é‡åˆ°ä»¥ä¸‹æƒ…å†µè¯·æ±‚å¸®åŠ©ï¼š1) æ— æ³•æ‰¾åˆ°è¶³å¤Ÿä¿¡æ¯ï¼ˆ<30 æ¡ï¼‰ï¼›2) ä¿¡æ¯æ¥æºå¯ä¿¡åº¦ä½ï¼›3) åˆ†æç»“è®ºå­˜åœ¨æ˜æ˜¾çŸ›ç›¾",
    "deliverable": "æœ€ç»ˆæŠ¥å‘Šä»¥ Markdown æ ¼å¼æäº¤ï¼Œé™„å¸¦ä¿¡æ¯æ¥æºåˆ—è¡¨å’ŒåŸå§‹æ•°æ®"
  },
  "escalation_policy": {
    "trigger_conditions": [
      "æœç´¢ 2 å°æ—¶åæ”¶é›†çš„æœ‰æ•ˆä¿¡æ¯å°‘äº 20 æ¡",
      "å‘ç°ç›¸äº’çŸ›ç›¾çš„å…³é”®æ•°æ®æ— æ³•åˆ¤æ–­",
      "ç ”ç©¶èŒƒå›´è¶…å‡ºåˆå§‹å®šä¹‰éœ€è¦è°ƒæ•´",
      "é¢„è®¡æ— æ³•åœ¨æˆªæ­¢æ—¶é—´å‰å®Œæˆ"
    ],
    "escalate_to": "å›¢é˜Ÿè´Ÿè´£äºº",
    "required_context": [
      "é—®é¢˜è¯¦ç»†æè¿°",
      "å·²å°è¯•çš„è§£å†³æ–¹æ¡ˆå’Œç»“æœ",
      "éœ€è¦çš„å…·ä½“æ”¯æŒï¼ˆæ›´å¤šæ—¶é—´ã€æ›´å¤šèµ„æºã€è°ƒæ•´èŒƒå›´ç­‰ï¼‰",
      "å»ºè®®çš„è§£å†³æ–¹æ¡ˆï¼ˆå¦‚æœ‰ï¼‰"
    ]
  },
  "system_prompt": "ä½ æ˜¯ä¸€åé«˜çº§å¸‚åœºç ”ç©¶åˆ†æå¸ˆï¼Œä¸“æ³¨äºç§‘æŠ€è¡Œä¸šçš„å¸‚åœºæƒ…æŠ¥æ”¶é›†å’Œåˆ†æã€‚\n\nã€ä½ çš„èŒè´£ã€‘\né€šè¿‡å¤šç§æ¸ é“æ”¶é›†ç›®æ ‡å¸‚åœºä¿¡æ¯ï¼Œåˆ†æå¸‚åœºè§„æ¨¡ã€å¢é•¿è¶‹åŠ¿ã€ç«äº‰æ ¼å±€ï¼Œè¯†åˆ«å…³é”®å¸‚åœºå‚ä¸è€…å’Œä»–ä»¬çš„ç­–ç•¥ï¼Œå‘ç°å¸‚åœºæœºä¼šå’Œæ½œåœ¨é£é™©ï¼Œå°†æ”¶é›†çš„ä¿¡æ¯æ•´ç†æˆç»“æ„åŒ–çš„ç ”ç©¶æŠ¥å‘Šã€‚\n\nã€å·¥ä½œæµç¨‹ã€‘\n1. éœ€æ±‚ç†è§£å’Œæœç´¢ç­–ç•¥åˆ¶å®š â†’ 2. ä¿¡æ¯æ”¶é›† â†’ 3. ä¿¡æ¯ç­›é€‰å’ŒéªŒè¯ â†’ 4. åˆ†æå’Œç»¼åˆ â†’ 5. æŠ¥å‘Šå®šç¨¿\n\nã€å¯ç”¨å·¥å…·ã€‘\n- web_search: ç½‘ç»œæœç´¢ï¼ˆæ¯æ¬¡ 3-5 ä¸ªå…³é”®è¯ï¼Œä¼˜å…ˆè‹±æ–‡ï¼‰\n- web_fetch: ç½‘é¡µæŠ“å–ï¼ˆä¼˜å…ˆå®˜æ–¹æŠ¥å‘Šã€æƒå¨åª’ä½“ï¼‰\n- memory_recall: æŸ¥è¯¢å†…éƒ¨è®°å¿†ï¼ˆé¿å…é‡å¤å·¥ä½œï¼‰\n\nã€è´¨é‡æ ‡å‡†ã€‘\n- ä¿¡æ¯å‡†ç¡®æ€§ï¼šæ‰€æœ‰æ•°æ®éœ€æœ‰æ˜ç¡®æ¥æºï¼Œå…³é”®æ•°æ®éœ€äº¤å‰éªŒè¯\n- æ—¶æ•ˆæ€§ï¼š80% ä»¥ä¸Šä¿¡æ¯åœ¨æœ€è¿‘ 2 å¹´å†…\n- å®Œæ•´æ€§ï¼šè¦†ç›–å¸‚åœºè§„æ¨¡ã€å¢é•¿è¶‹åŠ¿ã€ç«äº‰æ ¼å±€ã€æœºä¼šé£é™©\n- å¯è¯»æ€§ï¼šç»“æ„æ¸…æ™°ï¼Œ3000-5000 å­—\n\nã€åä½œæ–¹å¼ã€‘\n- ä»å›¢é˜Ÿè´Ÿè´£äººæ¥æ”¶ä»»åŠ¡ï¼ˆJSON æ ¼å¼ï¼‰\n- æ¯å®Œæˆä¸€æ­¥å‘é€è¿›åº¦æ›´æ–°\n- é‡åˆ°å›°éš¾åŠæ—¶è¯·æ±‚å¸®åŠ©\n- æœ€ç»ˆæäº¤ Markdown æŠ¥å‘Š\n\nã€å‡çº§æœºåˆ¶ã€‘\nä»¥ä¸‹æƒ…å†µå‘å›¢é˜Ÿè´Ÿè´£äººå‡çº§ï¼šæœç´¢ 2 å°æ—¶ä¿¡æ¯<20 æ¡ã€å‘ç°çŸ›ç›¾æ•°æ®æ— æ³•åˆ¤æ–­ã€ç ”ç©¶èŒƒå›´éœ€è°ƒæ•´ã€é¢„è®¡æ— æ³•æŒ‰æ—¶å®Œæˆã€‚å‡çº§æ—¶æä¾›ï¼šé—®é¢˜æè¿°ã€å·²å°è¯•æ–¹æ¡ˆã€éœ€è¦æ”¯æŒã€å»ºè®®æ–¹æ¡ˆã€‚\n\nè¯·ä¸“ä¸šã€é«˜æ•ˆåœ°å®Œæˆä½ çš„å·¥ä½œï¼Œä¸ºé¡¹ç›®å†³ç­–æä¾›å¯é çš„æ•°æ®æ”¯æŒã€‚"
}
```

---

## äº”ã€èµ„æºç®¡ç†å’Œå®¡æ‰¹

### 5.1 èµ„æºé…é¢æ¨¡å‹

```rust
// src/agent/resource_manager.rs

/// èµ„æºé…é¢
#[derive(Clone, Serialize, Deserialize)]
pub struct ResourceQuota {
    /// Token é…é¢
    pub token_quota: usize,
    /// æœ€å¤§å¹¶å‘ Agent æ•°
    pub max_concurrent_agents: usize,
    /// æ—¶é—´é¢„ç®—ï¼ˆç§’ï¼‰
    pub time_budget_secs: u64,
    /// æˆæœ¬é¢„ç®—ï¼ˆç¾åˆ†ï¼‰
    pub cost_budget_cents: u32,
    /// å·¥å…·è°ƒç”¨æ¬¡æ•°é™åˆ¶
    pub tool_call_limit: usize,
}

/// èµ„æºä½¿ç”¨ç»Ÿè®¡
#[derive(Clone, Serialize, Deserialize)]
pub struct ResourceUsage {
    pub tokens_used: usize,
    pub current_agents: usize,
    pub elapsed_secs: u64,
    pub cost_cents: u32,
    pub tool_calls: usize,
}

impl ResourceManager {
    /// CEO åˆ†é…åˆå§‹é…é¢
    pub fn allocate_initial_quota(&self, analysis: &TaskAnalysis, pattern: &CollaborationPattern) -> ResourceQuota {
        ResourceQuota {
            token_quota: self.estimate_token_usage(analysis) * 120 / 100, // 20% ç¼“å†²
            max_concurrent_agents: pattern.team_structure.recommended_agents,
            time_budget_secs: self.estimate_time(analysis) * 150 / 100,
            cost_budget_cents: self.estimate_cost(analysis) * 150 / 100,
            tool_call_limit: analysis.estimated_scale * 3,
        }
    }

    /// å®¡æ‰¹å›¢é˜Ÿçš„èµ„æºè°ƒæ•´ç”³è¯·
    pub async fn review_quota_adjustment(
        &self,
        request: &QuotaAdjustmentRequest,
        project_status: &ProjectStatus,
    ) -> QuotaDecision {
        // è¯„ä¼°å›¢é˜Ÿè¡¨ç°
        let performance_score = self.evaluate_performance(project_status);
        
        // æ£€æŸ¥èµ„æºä½™é‡
        let available_resources = self.get_available_resources();
        
        // å†³ç­–é€»è¾‘
        if performance_score < 0.5 {
            // è¡¨ç°ä¸ä½³ï¼Œæ‹’ç»æˆ–å‡å°‘
            QuotaDecision::Denied {
                reason: "å›¢é˜Ÿè¡¨ç°ä¸ä½³ï¼Œå»ºè®®å…ˆä¼˜åŒ–æ‰§è¡Œæ•ˆç‡".to_string(),
                counter_offer: None,
            }
        } else if available_resources < request.requested_increase {
            // èµ„æºä¸è¶³ï¼Œéƒ¨åˆ†æ‰¹å‡†
            QuotaDecision::PartialApproval {
                approved_quota: self.calculate_partial_quota(&request, &available_resources),
                reason: "èµ„æºç´§å¼ ï¼Œéƒ¨åˆ†æ‰¹å‡†".to_string(),
            }
        } else if performance_score > 0.8 && request.reason.contains("è¿›å±•é¡ºåˆ©") {
            // è¡¨ç°ä¼˜ç§€ï¼Œé¢å¤–å¥–åŠ±
            QuotaDecision::ApprovedWithBonus {
                approved_quota: request.new_quota.clone(),
                bonus_percentage: 10,
                reason: "å›¢é˜Ÿè¡¨ç°ä¼˜ç§€ï¼Œé¢å¤–å¥–åŠ± 10% èµ„æº".to_string(),
            }
        } else {
            // æ­£å¸¸æ‰¹å‡†
            QuotaDecision::Approved {
                approved_quota: request.new_quota.clone(),
            }
        }
    }

    /// è¯„ä¼°å›¢é˜Ÿè¡¨ç°
    fn evaluate_performance(&self, status: &ProjectStatus) -> f32 {
        let mut score = 0.0;
        
        // è¿›åº¦è¯„åˆ†ï¼ˆ40%ï¼‰
        let progress_score = status.completed_percentage as f32 / 100.0;
        score += progress_score * 0.4;
        
        // è´¨é‡è¯„åˆ†ï¼ˆ30%ï¼‰
        let quality_score = status.average_quality_score / 10.0;
        score += quality_score * 0.3;
        
        // æ•ˆç‡è¯„åˆ†ï¼ˆ20%ï¼‰
        let efficiency_score = self.calculate_efficiency_score(status);
        score += efficiency_score * 0.2;
        
        // æ²Ÿé€šè¯„åˆ†ï¼ˆ10%ï¼‰
        let communication_score = status.communication_score / 10.0;
        score += communication_score * 0.1;
        
        score
    }
}

/// é…é¢å†³ç­–ç»“æœ
#[derive(Clone, Serialize, Deserialize)]
pub enum QuotaDecision {
    Approved {
        approved_quota: ResourceQuota,
    },
    ApprovedWithBonus {
        approved_quota: ResourceQuota,
        bonus_percentage: u8,
        reason: String,
    },
    PartialApproval {
        approved_quota: ResourceQuota,
        reason: String,
    },
    Denied {
        reason: String,
        counter_offer: Option<ResourceQuota>,
    },
}
```

---

## å…­ã€ç”¨æˆ·äº¤äº’è®¾è®¡

### 6.1 ç”¨æˆ·ï¼ˆè‘£äº‹é•¿ï¼‰è§†è§’

```
ç”¨æˆ· â†” CEOï¼ˆTelegram Botï¼‰

ç”¨æˆ·å‘é€ï¼š"æˆ‘æƒ³äº†è§£ AI ç¼–ç¨‹åŠ©æ‰‹å¸‚åœº"

CEO å›å¤ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ”¶åˆ°ï¼Œè‘£äº‹é•¿ã€‚

è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„å¸‚åœºè°ƒç ”ä»»åŠ¡ï¼Œæˆ‘å°†å¯åŠ¨"å¸‚åœºè°ƒç ”é¡¹ç›®"ã€‚

ã€é¡¹ç›®ä¿¡æ¯ã€‘
- é¡¹ç›®åç§°ï¼šAI ç¼–ç¨‹åŠ©æ‰‹å¸‚åœºè°ƒç ”
- åä½œæ¨¡å¼ï¼šå¹¿æ’’ç½‘å¹¶è¡Œé‡‡é›†
- å›¢é˜Ÿè´Ÿè´£äººï¼šå¸‚åœºç ”ç©¶ä¸“å®¶ Agent
- é¢„è®¡å›¢é˜Ÿè§„æ¨¡ï¼š15-30 ä¸ª Worker Agent
- é¢„è®¡å®Œæˆæ—¶é—´ï¼š2 å°æ—¶
- èµ„æºé…é¢ï¼š50 ä¸‡ Token

é¡¹ç›®å·²å¯åŠ¨ï¼Œæˆ‘ä¼šæŒç»­ç›‘æ§è¿›å±•å¹¶åœ¨å®Œæˆæ—¶å‘æ‚¨æ±‡æŠ¥ã€‚

æ‚¨éšæ—¶å¯ä»¥è¯¢é—®ï¼š
- "é¡¹ç›®è¿›å±•å¦‚ä½•" - æŸ¥çœ‹è¿›åº¦
- "æŸ¥çœ‹ AI ç¼–ç¨‹åŠ©æ‰‹å¸‚åœºè°ƒç ”" - æŸ¥çœ‹é¡¹ç›®è¯¦æƒ…
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

2 å°æ—¶å...

CEO å›å¤ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
è‘£äº‹é•¿ï¼Œ"AI ç¼–ç¨‹åŠ©æ‰‹å¸‚åœºè°ƒç ”"é¡¹ç›®å·²å®Œæˆã€‚

ã€é¡¹ç›®æˆæœã€‘
- æ”¶é›†ä¿¡æ¯ï¼š156 æ¡
- åˆ†ææŠ¥å‘Šï¼š1 ä»½ï¼ˆ4500 å­—ï¼‰
- å…³é”®å‘ç°ï¼š
  1. å…¨çƒ AI ç¼–ç¨‹åŠ©æ‰‹å¸‚åœºè§„æ¨¡ 2025 å¹´è¾¾$XX äº¿
  2. ä¸»è¦ç«äº‰è€…ï¼šGitHub Copilotã€Cursorã€Codeium
  3. å¢é•¿è¶‹åŠ¿ï¼šå¹´å¤åˆå¢é•¿ç‡ XX%
  4. å¸‚åœºæœºä¼šï¼š...

ã€èµ„æºä½¿ç”¨ã€‘
- Token ä½¿ç”¨ï¼š42 ä¸‡ / 50 ä¸‡ï¼ˆ84%ï¼‰
- å®é™…è€—æ—¶ï¼š1 å°æ—¶ 45 åˆ†
- å›¢é˜Ÿè§„æ¨¡ï¼šå³°å€¼ 22 ä¸ª Agent

ã€äº¤ä»˜ç‰©ã€‘
ğŸ“„ å®Œæ•´æŠ¥å‘Šï¼š[æŸ¥çœ‹é“¾æ¥]

è¯·å®¡é˜…ï¼Œå¦‚æœ‰å…¶ä»–éœ€æ±‚è¯·éšæ—¶å‘ŠçŸ¥ã€‚
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

### 6.2 æŸ¥çœ‹é¡¹ç›®è¯¦æƒ…

```
ç”¨æˆ·å‘é€ï¼š"æŸ¥çœ‹ AI ç¼–ç¨‹åŠ©æ‰‹å¸‚åœºè°ƒç ”"

CEO å›å¤ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€é¡¹ç›®è¯¦æƒ…ã€‘AI ç¼–ç¨‹åŠ©æ‰‹å¸‚åœºè°ƒç ”

ã€åŸºæœ¬ä¿¡æ¯ã€‘
- çŠ¶æ€ï¼šâœ… å·²å®Œæˆ
- å¯åŠ¨æ—¶é—´ï¼š2026-02-28 14:00
- å®Œæˆæ—¶é—´ï¼š2026-02-28 15:45
- åä½œæ¨¡å¼ï¼šå¹¿æ’’ç½‘å¹¶è¡Œé‡‡é›†

ã€å›¢é˜Ÿç»“æ„ã€‘
- å›¢é˜Ÿè´Ÿè´£äººï¼šå¸‚åœºç ”ç©¶ä¸“å®¶
- Worker Agent: 22 ä¸ª
  - ä¿¡æ¯æ”¶é›† Agent: 15 ä¸ª
  - æ•°æ®åˆ†æ Agent: 5 ä¸ª
  - æŠ¥å‘Šæ’°å†™ Agent: 2 ä¸ª

ã€ä»»åŠ¡åˆ†è§£ã€‘
âœ… éœ€æ±‚åˆ†æå’Œæœç´¢ç­–ç•¥ï¼ˆå®Œæˆï¼‰
âœ… ä¿¡æ¯æ”¶é›†ï¼ˆå®Œæˆï¼‰- 156 æ¡
âœ… ä¿¡æ¯ç­›é€‰å’ŒéªŒè¯ï¼ˆå®Œæˆï¼‰- ä¿ç•™ 89 æ¡
âœ… åˆ†æå’Œç»¼åˆï¼ˆå®Œæˆï¼‰
âœ… æŠ¥å‘Šå®šç¨¿ï¼ˆå®Œæˆï¼‰

ã€èµ„æºä½¿ç”¨ã€‘
- Token: 42 ä¸‡ / 50 ä¸‡ï¼ˆ84%ï¼‰
- æ—¶é—´ï¼š1h45m / 2hï¼ˆ87.5%ï¼‰
- æˆæœ¬ï¼š$0.42 / $0.50ï¼ˆ84%ï¼‰

ã€äº¤ä»˜ç‰©ã€‘
ğŸ“„ å®Œæ•´æŠ¥å‘Šï¼š[æŸ¥çœ‹é“¾æ¥]
ğŸ“Š åŸå§‹æ•°æ®ï¼š[ä¸‹è½½é“¾æ¥]
ğŸ“‹ ä¿¡æ¯æ¥æºåˆ—è¡¨ï¼š[æŸ¥çœ‹é“¾æ¥]

ã€å›¢é˜Ÿè¡¨ç°ã€‘
- è¿›åº¦ï¼šâ­â­â­â­â­ (5/5)
- è´¨é‡ï¼šâ­â­â­â­â­ (5/5)
- æ•ˆç‡ï¼šâ­â­â­â­â˜† (4.5/5)
- æ²Ÿé€šï¼šâ­â­â­â­â­ (5/5)

éœ€è¦æˆ‘åšä»€ä¹ˆå—ï¼Ÿ
- "é‡æ–°ç”ŸæˆæŠ¥å‘Š" - è°ƒæ•´æ–¹å‘é‡æ–°åˆ†æ
- "æ·±å…¥åˆ†æ XX æ–¹é¢" - å¯åŠ¨åç»­ç ”ç©¶
- "å¯¼å‡ºä¸º PDF" - æ ¼å¼è½¬æ¢
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

## å…­ã€è¡¥å……ç­–ç•¥

### 6.1 å›¢é˜Ÿè®°å¿†å…±äº«æœºåˆ¶

#### è®¾è®¡ç†å¿µ

å€Ÿé‰´ä¼ä¸šçŸ¥è¯†ç®¡ç†ç³»ç»Ÿï¼Œå®ç°**ä¸‰å±‚è®°å¿†å…±äº«**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        é›†ç¾¤è®°å¿† (CEO å±‚)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  é›†ç¾¤ç»éªŒåº“                                               â”‚    â”‚
â”‚  â”‚  - æˆåŠŸé¡¹ç›®æ¡ˆä¾‹ï¼ˆå¯å¤ç”¨çš„æ¨¡å¼/æµç¨‹ï¼‰                       â”‚    â”‚
â”‚  â”‚  - å¤±è´¥é¡¹ç›®å¤ç›˜ï¼ˆé¿å…çš„é”™è¯¯ï¼‰                             â”‚    â”‚
â”‚  â”‚  - æœ€ä½³å®è·µåº“ï¼ˆå„é¢†åŸŸçš„æ ‡å‡†å·¥ä½œæµç¨‹ï¼‰                      â”‚    â”‚
â”‚  â”‚  - èµ„æºä½¿ç”¨ç»Ÿè®¡ï¼ˆå„æ¨¡å¼çš„å¹³å‡æ¶ˆè€—ï¼‰                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†‘                                   â”‚
â”‚              CEO ä¸»åŠ¨æ¨é€ / é¡¹ç›®è´Ÿè´£äººæŸ¥è¯¢                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        é¡¹ç›®è®°å¿† (å›¢é˜Ÿå±‚)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  é¡¹ç›®çŸ¥è¯†åº“                                               â”‚    â”‚
â”‚  â”‚  - å½“å‰é¡¹ç›®æ–‡æ¡£ï¼ˆæ‰€æœ‰ Worker çš„äº§å‡ºï¼‰                       â”‚    â”‚
â”‚  â”‚  - ä¸­é—´æˆæœï¼ˆæœªå®Œæˆä½†æœ‰ä»·å€¼çš„å‘ç°ï¼‰                       â”‚    â”‚
â”‚  â”‚  - é—®é¢˜è§£å†³æ–¹æ¡ˆï¼ˆå·²è§£å†³çš„æŠ€æœ¯éš¾é¢˜ï¼‰                       â”‚    â”‚
â”‚  â”‚  - Worker åä½œè®°å½•ï¼ˆæ²Ÿé€šå†å²ã€å†³ç­–è®°å½•ï¼‰                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                              â†‘                                   â”‚
â”‚              é¡¹ç›®è´Ÿè´£äººä¸»åŠ¨å…±äº« / Worker è‡ªåŠ¨è´¡çŒ®                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Worker è®°å¿† (ä¸ªä½“å±‚)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  å·¥ä½œè®°å¿†                                                 â”‚    â”‚
â”‚  â”‚  - å½“å‰ä»»åŠ¡ä¸Šä¸‹æ–‡                                        â”‚    â”‚
â”‚  â”‚  - å·²å°è¯•æ–¹æ¡ˆå’Œç»“æœ                                      â”‚    â”‚
â”‚  â”‚  - ä¸´æ—¶æ•°æ®å’Œä¸­é—´ç»“æœ                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è®°å¿†å…±äº«æµç¨‹

```rust
// src/agent/memory/sharing.rs

/// è®°å¿†å…±äº«ç®¡ç†å™¨
pub struct MemorySharingManager {
    /// é›†ç¾¤ç»éªŒåº“
    cluster_experience: Arc<DashMap<String, ExperienceEntry>>,
    /// é¡¹ç›®çŸ¥è¯†åº“
    project_knowledge: Arc<DashMap<String, ProjectKnowledge>>,
    /// è®°å¿†è®¿é—®ç»Ÿè®¡ï¼ˆç”¨äºä¼˜åŒ–ï¼‰
    access_stats: DashMap<String, AccessStats>,
}

/// ç»éªŒæ¡ç›®ï¼ˆé›†ç¾¤å±‚ï¼‰
#[derive(Clone, Serialize, Deserialize)]
pub struct ExperienceEntry {
    /// ç»éªŒç±»å‹
    pub entry_type: ExperienceType,
    /// æ¥æºé¡¹ç›®
    pub source_project: String,
    /// ç»éªŒæè¿°
    pub description: String,
    /// é€‚ç”¨åœºæ™¯
    pub applicable_scenarios: Vec<String>,
    /// å¯å¤ç”¨çš„æ¨¡å¼/æµç¨‹
    pub reusable_pattern: Option<CollaborationPattern>,
    /// é¿å…çš„é”™è¯¯
    pub pitfalls_to_avoid: Vec<String>,
    /// è´¡çŒ®è€…ï¼ˆé¡¹ç›®è´Ÿè´£äººï¼‰
    pub contributor: String,
    /// è´¡çŒ®æ—¶é—´
    pub contributed_at: DateTime<Utc>,
    /// è¢«å¼•ç”¨æ¬¡æ•°
    pub citation_count: usize,
    /// æœ‰æ•ˆæ€§è¯„åˆ†ï¼ˆ0-1ï¼‰
    pub effectiveness_score: f32,
}

#[derive(Clone, Serialize, Deserialize)]
pub enum ExperienceType {
    /// æˆåŠŸç»éªŒï¼ˆå¯å¤ç”¨ï¼‰
    SuccessStory,
    /// å¤±è´¥å¤ç›˜ï¼ˆé¿å…é”™è¯¯ï¼‰
    FailureReview,
    /// æœ€ä½³å®è·µ
    BestPractice,
    /// èµ„æºä½¿ç”¨ç»Ÿè®¡
    ResourceStatistics,
}

/// é¡¹ç›®çŸ¥è¯†ï¼ˆå›¢é˜Ÿå±‚ï¼‰
#[derive(Clone, Serialize, Deserialize)]
pub struct ProjectKnowledge {
    /// é¡¹ç›® ID
    pub project_id: String,
    /// çŸ¥è¯†æ¡ç›®
    pub entries: Vec<KnowledgeEntry>,
    /// å…±äº«çŠ¶æ€
    pub sharing_status: SharingStatus,
    /// æœ€åæ›´æ–°
    pub last_updated: DateTime<Utc>,
}

#[derive(Clone, Serialize, Deserialize)]
pub struct KnowledgeEntry {
    /// çŸ¥è¯†ç±»å‹
    pub entry_type: KnowledgeType,
    /// è´¡çŒ®è€…ï¼ˆWorker IDï¼‰
    pub contributor: String,
    /// çŸ¥è¯†å†…å®¹
    pub content: String,
    /// å…³è”ä»»åŠ¡
    pub related_task: Option<String>,
    /// è¢«è®¿é—®æ¬¡æ•°
    pub access_count: usize,
}

#[derive(Clone, Copy, Serialize, Deserialize)]
pub enum KnowledgeType {
    /// é¡¹ç›®æ–‡æ¡£
    Documentation,
    /// ä¸­é—´æˆæœ
    IntermediateResult,
    /// é—®é¢˜è§£å†³æ–¹æ¡ˆ
    ProblemSolution,
    /// åä½œè®°å½•
    CollaborationRecord,
}

#[derive(Clone, Copy, Serialize, Deserialize, PartialEq)]
pub enum SharingStatus {
    /// ç§æœ‰ï¼ˆä»…é¡¹ç›®å†…å¯è§ï¼‰
    Private,
    /// å·²ç”³è¯·å…±äº«ï¼ˆç­‰å¾… CEO å®¡æ‰¹ï¼‰
    PendingApproval,
    /// å·²å…±äº«åˆ°é›†ç¾¤
    SharedToCluster,
    /// æ¨èå…±äº«ï¼ˆCEO æ ‡è®°ä¸ºæœ‰ä»·å€¼ï¼‰
    RecommendedForSharing,
}

impl MemorySharingManager {
    /// Worker è´¡çŒ®çŸ¥è¯†åˆ°é¡¹ç›®è®°å¿†
    pub async fn worker_contribute(
        &self,
        project_id: &str,
        worker_id: &str,
        knowledge: KnowledgeEntry,
    ) -> Result<()> {
        let mut project = self.project_knowledge
            .get_mut(project_id)
            .ok_or("é¡¹ç›®ä¸å­˜åœ¨")?;
        
        project.entries.push(knowledge);
        project.last_updated = Utc::now();
        
        // è‡ªåŠ¨æ£€æŸ¥æ˜¯å¦å€¼å¾—å…±äº«åˆ°é›†ç¾¤
        if self.is_worth_sharing(&knowledge) {
            project.sharing_status = SharingStatus::RecommendedForSharing;
            // é€šçŸ¥é¡¹ç›®è´Ÿè´£äºº
            self.notify_team_lead(project_id, "å‘ç°æ½œåœ¨æœ‰ä»·å€¼çŸ¥è¯†ï¼Œå»ºè®®å…±äº«åˆ°é›†ç¾¤").await?;
        }
        
        Ok(())
    }

    /// é¡¹ç›®è´Ÿè´£äººä¸»åŠ¨å…±äº«åˆ°é›†ç¾¤
    pub async fn team_lead_share_to_cluster(
        &self,
        project_id: &str,
        knowledge_ids: Vec<String>,
        share_reason: &str,
    ) -> Result<()> {
        let project = self.project_knowledge
            .get(project_id)
            .ok_or("é¡¹ç›®ä¸å­˜åœ¨")?;
        
        // æå–çŸ¥è¯†æ¡ç›®
        let entries: Vec<_> = project.entries.iter()
            .filter(|e| knowledge_ids.contains(&e.contributor))
            .collect();
        
        // åˆ›å»ºé›†ç¾¤ç»éªŒæ¡ç›®
        let experience = ExperienceEntry {
            entry_type: ExperienceType::BestPractice,
            source_project: project_id.clone(),
            description: format!("æ¥è‡ª{}é¡¹ç›®çš„ç»éªŒåˆ†äº«ï¼š{}", project_id, share_reason),
            applicable_scenarios: self.extract_applicable_scenarios(&entries),
            reusable_pattern: None, // å¯é€‰
            pitfalls_to_avoid: vec![],
            contributor: project_id.clone(),
            contributed_at: Utc::now(),
            citation_count: 0,
            effectiveness_score: 0.5, // åˆå§‹å€¼
        };
        
        // æ·»åŠ åˆ°é›†ç¾¤ç»éªŒåº“
        self.cluster_experience.insert(
            format!("{}_{}", project_id, Utc::now().timestamp()),
            experience,
        );
        
        // æ›´æ–°é¡¹ç›®å…±äº«çŠ¶æ€
        let mut project = self.project_knowledge.get_mut(project_id).unwrap();
        project.sharing_status = SharingStatus::SharedToCluster;
        
        Ok(())
    }

    /// CEO æ¨é€é›†ç¾¤ç»éªŒåˆ°é¡¹ç›®
    pub async fn ceo_push_to_project(
        &self,
        project_id: &str,
        experience_id: &str,
        push_reason: &str,
    ) -> Result<()> {
        let experience = self.cluster_experience
            .get(experience_id)
            .ok_or("ç»éªŒä¸å­˜åœ¨")?;
        
        // åˆ›å»ºé¡¹ç›®çŸ¥è¯†æ¡ç›®
        let knowledge = KnowledgeEntry {
            entry_type: KnowledgeType::ProblemSolution,
            contributor: "CEO".to_string(),
            content: format!(
                "ã€é›†ç¾¤ç»éªŒæ¨èã€‘{}\né€‚ç”¨åœºæ™¯ï¼š{}\n{}\næ¨èåŸå› ï¼š{}",
                experience.description,
                experience.applicable_scenarios.join(", "),
                experience.description,
                push_reason
            ),
            related_task: None,
            access_count: 0,
        };
        
        // æ·»åŠ åˆ°é¡¹ç›®çŸ¥è¯†
        let mut project = self.project_knowledge.get_mut(project_id).unwrap();
        project.entries.push(knowledge);
        project.last_updated = Utc::now();
        
        // é€šçŸ¥é¡¹ç›®è´Ÿè´£äºº
        self.notify_team_lead(project_id, &format!(
            "CEO æ¨é€é›†ç¾¤ç»éªŒï¼š{}ï¼Œè¯·æŸ¥é˜…å‚è€ƒ",
            experience.description
        )).await?;
        
        Ok(())
    }

    /// é¡¹ç›®å®Œæˆæ—¶è‡ªåŠ¨å¤ç›˜
    pub async fn auto_review_on_completion(
        &self,
        project_id: &str,
        project_result: &ProjectResult,
    ) -> Result<()> {
        // åˆ†æé¡¹ç›®ç»“æœ
        let review = self.generate_project_review(project_result).await?;
        
        // åˆ›å»ºç»éªŒæ¡ç›®
        let experience = ExperienceEntry {
            entry_type: if project_result.success {
                ExperienceType::SuccessStory
            } else {
                ExperienceType::FailureReview
            },
            source_project: project_id.to_string(),
            description: review.summary,
            applicable_scenarios: review.applicable_scenarios,
            reusable_pattern: review.reusable_pattern,
            pitfalls_to_avoid: review.pitfalls,
            contributor: project_id.to_string(),
            contributed_at: Utc::now(),
            citation_count: 0,
            effectiveness_score: if project_result.success { 0.8 } else { 0.5 },
        };
        
        // è‡ªåŠ¨æ·»åŠ åˆ°é›†ç¾¤ç»éªŒåº“
        self.cluster_experience.insert(
            format!("review_{}_{}", project_id, Utc::now().timestamp()),
            experience,
        );
        
        Ok(())
    }

    /// æŸ¥è¯¢é›†ç¾¤ç»éªŒï¼ˆä¾›é¡¹ç›®è´Ÿè´£äººå‚è€ƒï¼‰
    pub async fn query_cluster_experience(
        &self,
        project_context: &str,
        top_k: usize,
    ) -> Vec<ExperienceEntry> {
        let mut all_entries: Vec<_> = self.cluster_experience.iter()
            .map(|e| e.value().clone())
            .collect();
        
        // æŒ‰ç›¸å…³æ€§æ’åº
        all_entries.sort_by(|a, b| {
            let score_a = self.calculate_relevance(a, project_context);
            let score_b = self.calculate_relevance(b, project_context);
            score_b.partial_cmp(&score_a).unwrap()
        });
        
        // è¿”å› Top-K
        all_entries.into_iter().take(top_k).collect()
    }

    /// æ£€æŸ¥çŸ¥è¯†æ˜¯å¦å€¼å¾—å…±äº«
    fn is_worth_sharing(&self, knowledge: &KnowledgeEntry) -> bool {
        // å¯å‘å¼è§„åˆ™ï¼š
        // 1. é—®é¢˜è§£å†³æ–¹æ¡ˆç±»å‹
        // 2. å†…å®¹é•¿åº¦>500 å­—ï¼ˆè¯¦ç»†è¯´æ˜ï¼‰
        // 3. åŒ…å«å…³é”®è¯ï¼ˆ"çªç ´"ã€"åˆ›æ–°"ã€"é¦–æ¬¡"ç­‰ï¼‰
        
        if knowledge.entry_type != KnowledgeType::ProblemSolution {
            return false;
        }
        
        if knowledge.content.len() < 500 {
            return false;
        }
        
        let valuable_keywords = ["çªç ´", "åˆ›æ–°", "é¦–æ¬¡", "æœ€ä½³å®è·µ", "æ¨è", "é‡è¦"];
        valuable_keywords.iter().any(|kw| knowledge.content.contains(kw))
    }

    /// è®¡ç®—ç»éªŒç›¸å…³æ€§
    fn calculate_relevance(&self, experience: &ExperienceEntry, context: &str) -> f32 {
        let mut score = 0.0;
        
        // åœºæ™¯åŒ¹é…ï¼ˆ40%ï¼‰
        for scenario in &experience.applicable_scenarios {
            if context.contains(scenario) {
                score += 0.4;
                break;
            }
        }
        
        // å¼•ç”¨æ¬¡æ•°ï¼ˆ30%ï¼‰
        score += (experience.citation_count.min(10) as f32) * 0.03;
        
        // æœ‰æ•ˆæ€§è¯„åˆ†ï¼ˆ30%ï¼‰
        score += experience.effectiveness_score * 0.3;
        
        score.min(1.0)
    }
}

/// é¡¹ç›®å¤ç›˜æŠ¥å‘Š
struct ProjectReview {
    summary: String,
    applicable_scenarios: Vec<String>,
    reusable_pattern: Option<CollaborationPattern>,
    pitfalls: Vec<String>,
}
```

#### è®°å¿†å…±äº«ç¤ºä¾‹

```
åœºæ™¯ 1: Worker è´¡çŒ®çŸ¥è¯†

Worker Agent (å¸‚åœºç ”ç©¶å‘˜):
"æˆ‘å‘ç°äº†ä¸€ä¸ªæ–°çš„æ•°æ®æ¥æºï¼Œå¯ä»¥è·å–æ›´å‡†ç¡®çš„å¸‚åœºè§„æ¨¡æ•°æ®ã€‚"
â†’ è‡ªåŠ¨è´¡çŒ®åˆ°é¡¹ç›®è®°å¿†
â†’ é¡¹ç›®è´Ÿè´£äººæ ‡è®°ä¸º"æœ‰ä»·å€¼"
â†’ CEO å®¡æ‰¹åå…±äº«åˆ°é›†ç¾¤ç»éªŒåº“
â†’ å…¶ä»–é¡¹ç›®å¯ä»¥æŸ¥è¯¢ä½¿ç”¨

åœºæ™¯ 2: CEO æ¨é€ç»éªŒ

CEO:
"æ£€æµ‹åˆ°ä½ ä»¬æ­£åœ¨è¿›è¡Œå¸‚åœºè°ƒç ”ï¼Œé›†ç¾¤ç»éªŒåº“ä¸­æœ‰ 3 ä¸ªç›¸å…³æˆåŠŸæ¡ˆä¾‹ï¼Œ
å·²æ¨é€åˆ°é¡¹ç›®è®°å¿†ï¼Œè¯·å‚è€ƒã€‚"
â†’ é¡¹ç›®è´Ÿè´£äººæŸ¥çœ‹æ¨é€
â†’ åº”ç”¨åˆ°å½“å‰é¡¹ç›®
â†’ æå‡æ•ˆç‡

åœºæ™¯ 3: é¡¹ç›®å®Œæˆè‡ªåŠ¨å¤ç›˜

é¡¹ç›®å®Œæˆ:
"AI ç¼–ç¨‹åŠ©æ‰‹å¸‚åœºè°ƒç ”"é¡¹ç›®å®Œæˆï¼Œè´¨é‡è¯„åˆ† 4.8/5
â†’ è‡ªåŠ¨åˆ›å»ºæˆåŠŸç»éªŒæ¡ç›®
â†’ æ·»åŠ åˆ°é›†ç¾¤ç»éªŒåº“
â†’ æ ‡è®°ä¸º"å¸‚åœºè°ƒç ”æœ€ä½³å®è·µ"
â†’ åç»­ç±»ä¼¼é¡¹ç›®å¯å‚è€ƒ
```

---

### 6.2 Worker è‡ªåŠ¨é‡è¯•ä¸çŠ¶æ€æ£€æŸ¥æœºåˆ¶

#### è®¾è®¡ç†å¿µ

å€Ÿé‰´å¤§æ•°æ®é›†ç¾¤ï¼ˆå¦‚ Kubernetesã€Sparkï¼‰çš„**å¥åº·æ£€æŸ¥ + è‡ªåŠ¨æ¢å¤**æœºåˆ¶ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Worker ç”Ÿå‘½å‘¨æœŸç®¡ç†                            â”‚
â”‚                                                                  â”‚
â”‚  åˆ›å»º â†’ åˆå§‹åŒ– â†’ è¿è¡Œä¸­ â†’ å®Œæˆä»»åŠ¡ â†’ é”€æ¯                        â”‚
â”‚           â†‘        â”‚                                              â”‚
â”‚           â”‚        â–¼                                              â”‚
â”‚           â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚           â”‚    â”‚çŠ¶æ€æ£€æŸ¥ â”‚                                       â”‚
â”‚           â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                       â”‚
â”‚           â”‚         â”‚                                            â”‚
â”‚           â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                                       â”‚
â”‚           â”‚    â–¼         â–¼                                       â”‚
â”‚           â”‚  å¥åº·      å¼‚å¸¸                                       â”‚
â”‚           â”‚   â”‚          â”‚                                        â”‚
â”‚           â”‚   â”‚    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                 â”‚
â”‚           â”‚   â”‚    â”‚ è‡ªåŠ¨é‡è¯•  â”‚                                 â”‚
â”‚           â”‚   â”‚    â”‚ (æœ€å¤š 3 æ¬¡) â”‚                                 â”‚
â”‚           â”‚   â”‚    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚           â”‚   â”‚          â”‚                                        â”‚
â”‚           â”‚   â”‚    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                 â”‚
â”‚           â”‚   â”‚    â–¼         â–¼                                   â”‚
â”‚           â”‚   â”‚  æˆåŠŸ     å¤±è´¥                                   â”‚
â”‚           â”‚   â”‚   â”‚        â”‚                                     â”‚
â”‚           â”‚   â”‚   â”‚    â”Œâ”€â”€â”€â”´â”€â”€â”€â”                                 â”‚
â”‚           â”‚   â”‚   â”‚    â”‚å‡çº§   â”‚                                 â”‚
â”‚           â”‚   â”‚   â”‚    â”‚è´Ÿè´£äºº â”‚                                 â”‚
â”‚           â”‚   â”‚   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚           â”‚   â”‚                                                  â”‚
â”‚           â”‚  ç»§ç»­è¿è¡Œ                                            â”‚
â”‚           â”‚                                                      â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                        å¿ƒè·³ä¿æ´»ï¼ˆæ¯ 30 ç§’ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### çŠ¶æ€æ£€æŸ¥ä¸é‡è¯•å®ç°

```rust
// src/agent/worker/health_check.rs

use tokio::time::{interval, Duration};
use std::sync::atomic::{AtomicU8, Ordering};

/// Worker å¥åº·çŠ¶æ€
#[derive(Clone, Copy, Debug, Serialize, Deserialize, PartialEq)]
#[serde(rename_all = "snake_case")]
pub enum WorkerHealthStatus {
    /// åˆå§‹åŒ–ä¸­
    Initializing,
    /// æ­£å¸¸è¿è¡Œ
    Healthy,
    /// å¿™ç¢Œä¸­ï¼ˆæ‰§è¡Œä»»åŠ¡ï¼‰
    Busy,
    /// å“åº”ç¼“æ…¢
    Slow,
    /// å¼‚å¸¸ï¼ˆå¯æ¢å¤ï¼‰
    Unhealthy,
    /// å¤±è´¥ï¼ˆä¸å¯æ¢å¤ï¼‰
    Failed,
    /// å·²ç»ˆæ­¢
    Terminated,
}

/// Worker å¥åº·æ£€æŸ¥å™¨
pub struct WorkerHealthChecker {
    /// Worker ID
    worker_id: String,
    /// å½“å‰çŠ¶æ€
    status: AtomicU8, // ä½¿ç”¨ AtomicU8 å­˜å‚¨ WorkerHealthStatus
    /// å¿ƒè·³é—´éš”ï¼ˆç§’ï¼‰
    heartbeat_interval_secs: u64,
    /// è¶…æ—¶é˜ˆå€¼ï¼ˆç§’ï¼‰
    timeout_threshold_secs: u64,
    /// æœ€å¤§é‡è¯•æ¬¡æ•°
    max_retry_count: u8,
    /// å½“å‰é‡è¯•æ¬¡æ•°
    current_retry_count: AtomicU8,
    /// ä»»åŠ¡æ‰§è¡Œç»Ÿè®¡
    task_stats: TaskStatistics,
}

/// ä»»åŠ¡ç»Ÿè®¡
#[derive(Clone, Default)]
pub struct TaskStatistics {
    /// æ€»ä»»åŠ¡æ•°
    pub total_tasks: usize,
    /// æˆåŠŸä»»åŠ¡æ•°
    pub successful_tasks: usize,
    /// å¤±è´¥ä»»åŠ¡æ•°
    pub failed_tasks: usize,
    /// é‡è¯•ä»»åŠ¡æ•°
    pub retried_tasks: usize,
    /// å¹³å‡æ‰§è¡Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    pub avg_execution_time_ms: f64,
}

/// è‡ªåŠ¨é‡è¯•ç­–ç•¥
#[derive(Clone, Serialize, Deserialize)]
pub struct RetryPolicy {
    /// æœ€å¤§é‡è¯•æ¬¡æ•°
    pub max_retries: u8,
    /// åˆå§‹é€€é¿æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    pub initial_backoff_ms: u64,
    /// æœ€å¤§é€€é¿æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
    pub max_backoff_ms: u64,
    /// é€€é¿ä¹˜æ•°
    pub backoff_multiplier: f32,
    /// å¯é‡è¯•çš„é”™è¯¯ç±»å‹
    pub retryable_errors: Vec<WorkerErrorType>,
}

/// Worker é”™è¯¯ç±»å‹
#[derive(Clone, Debug, Serialize, Deserialize, PartialEq)]
pub enum WorkerErrorType {
    /// ç½‘ç»œè¶…æ—¶
    NetworkTimeout,
    /// API é™æµ
    RateLimited,
    /// ä¸´æ—¶æœåŠ¡ä¸å¯ç”¨
    TemporaryUnavailable,
    /// èµ„æºä¸è¶³
    InsufficientResources,
    /// ä»»åŠ¡æ‰§è¡Œè¶…æ—¶
    TaskTimeout,
    /// å…¶ä»–å¯æ¢å¤é”™è¯¯
    OtherRecoverable,
    /// ä¸å¯æ¢å¤é”™è¯¯
    Unrecoverable,
}

impl WorkerHealthChecker {
    /// åˆ›å»ºå¥åº·æ£€æŸ¥å™¨
    pub fn new(worker_id: String, config: &HealthCheckConfig) -> Self {
        Self {
            worker_id,
            status: AtomicU8::new(WorkerHealthStatus::Initializing as u8),
            heartbeat_interval_secs: config.heartbeat_interval_secs,
            timeout_threshold_secs: config.timeout_threshold_secs,
            max_retry_count: config.max_retry_count,
            current_retry_count: AtomicU8::new(0),
            task_stats: TaskStatistics::default(),
        }
    }

    /// å¯åŠ¨å¥åº·æ£€æŸ¥å¾ªç¯
    pub async fn start_health_check_loop(
        self: Arc<Self>,
        worker: Arc<WorkerAgent>,
    ) -> Result<()> {
        let mut heartbeat_interval = interval(Duration::from_secs(self.heartbeat_interval_secs));
        let mut status_check_interval = interval(Duration::from_secs(10)); // æ¯ 10 ç§’æ£€æŸ¥çŠ¶æ€

        loop {
            tokio::select! {
                // å¿ƒè·³
                _ = heartbeat_interval.tick() => {
                    self.send_heartbeat(&worker).await?;
                }
                // çŠ¶æ€æ£€æŸ¥
                _ = status_check_interval.tick() => {
                    self.check_status(&worker).await?;
                }
            }
        }
    }

    /// å‘é€å¿ƒè·³
    async fn send_heartbeat(&self, worker: &WorkerAgent) -> Result<()> {
        let status = self.get_status();
        
        // å‘å›¢é˜Ÿè´Ÿè´£äººå‘é€å¿ƒè·³
        worker.report_to_lead(&format!(
            "å¿ƒè·³ï¼šçŠ¶æ€={:?}, ä»»åŠ¡ç»Ÿè®¡={:?}",
            status, self.task_stats
        )).await?;
        
        Ok(())
    }

    /// æ£€æŸ¥çŠ¶æ€
    async fn check_status(&self, worker: &WorkerAgent) -> Result<()> {
        let current_status = self.get_status();
        
        match current_status {
            WorkerHealthStatus::Healthy | WorkerHealthStatus::Busy => {
                // æ­£å¸¸ï¼Œæ— éœ€æ“ä½œ
            }
            WorkerHealthStatus::Slow => {
                // å“åº”ç¼“æ…¢ï¼Œè®°å½•æ—¥å¿—
                tracing::warn!(worker_id = %self.worker_id, "Worker å“åº”ç¼“æ…¢");
            }
            WorkerHealthStatus::Unhealthy => {
                // å¼‚å¸¸ï¼Œå°è¯•è‡ªåŠ¨æ¢å¤
                self.attempt_auto_recovery(worker).await?;
            }
            WorkerHealthStatus::Failed => {
                // å¤±è´¥ï¼Œé€šçŸ¥å›¢é˜Ÿè´Ÿè´£äºº
                worker.escalate_to_lead(&format!(
                    "Worker {} å¤±è´¥ï¼Œä»»åŠ¡ç»Ÿè®¡ï¼š{:?}",
                    self.worker_id, self.task_stats
                )).await?;
            }
            _ => {}
        }
        
        Ok(())
    }

    /// å°è¯•è‡ªåŠ¨æ¢å¤
    async fn attempt_auto_recovery(&self, worker: &WorkerAgent) -> Result<()> {
        let current_retry = self.current_retry_count.load(Ordering::Relaxed);
        
        if current_retry >= self.max_retry_count {
            // è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œæ ‡è®°ä¸ºå¤±è´¥
            self.set_status(WorkerHealthStatus::Failed);
            return Err("è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°".into());
        }
        
        // è®¡ç®—é€€é¿æ—¶é—´ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
        let backoff_ms = self.calculate_backoff(current_retry);
        tracing::info!(
            worker_id = %self.worker_id,
            retry_count = current_retry,
            backoff_ms = backoff_ms,
            "å°è¯•è‡ªåŠ¨æ¢å¤"
        );
        
        // ç­‰å¾…é€€é¿æ—¶é—´
        tokio::time::sleep(Duration::from_millis(backoff_ms)).await;
        
        // é‡ç½® Worker çŠ¶æ€
        worker.reset_state().await?;
        
        // é‡è¯•å½“å‰ä»»åŠ¡
        if let Some(task) = &worker.current_task {
            self.current_retry_count.fetch_add(1, Ordering::Relaxed);
            self.task_stats.retried_tasks += 1;
            
            match worker.retry_task(task).await {
                Ok(_) => {
                    // é‡è¯•æˆåŠŸ
                    self.set_status(WorkerHealthStatus::Healthy);
                    self.current_retry_count.store(0, Ordering::Relaxed);
                }
                Err(e) => {
                    // é‡è¯•å¤±è´¥ï¼Œç»§ç»­ç´¯åŠ é‡è¯•æ¬¡æ•°
                    tracing::error!(worker_id = %self.worker_id, error = %e, "é‡è¯•å¤±è´¥");
                }
            }
        }
        
        Ok(())
    }

    /// è®¡ç®—é€€é¿æ—¶é—´ï¼ˆæŒ‡æ•°é€€é¿ + æŠ–åŠ¨ï¼‰
    fn calculate_backoff(&self, retry_count: u8) -> u64 {
        let policy = RetryPolicy {
            max_retries: 3,
            initial_backoff_ms: 1000,
            max_backoff_ms: 60000,
            backoff_multiplier: 2.0,
            retryable_errors: vec![
                WorkerErrorType::NetworkTimeout,
                WorkerErrorType::RateLimited,
                WorkerErrorType::TemporaryUnavailable,
            ],
        };
        
        // æŒ‡æ•°é€€é¿
        let backoff = policy.initial_backoff_ms as f64
            * policy.backoff_multiplier.pow(retry_count as u32) as f64;
        
        // é™åˆ¶æœ€å¤§å€¼
        let capped_backoff = backoff.min(policy.max_backoff_ms as f64);
        
        // æ·»åŠ æŠ–åŠ¨ï¼ˆÂ±20%ï¼‰ï¼Œé¿å…å¤šä¸ª Worker åŒæ—¶é‡è¯•
        let jitter = (rand::random::<f64>() * 0.4 - 0.2) * capped_backoff;
        
        (capped_backoff + jitter) as u64
    }

    /// æ‰§è¡Œä»»åŠ¡ï¼ˆå¸¦çŠ¶æ€è·Ÿè¸ªï¼‰
    pub async fn execute_task_with_monitoring(
        &self,
        worker: &WorkerAgent,
        task: &SubTask,
    ) -> Result<TaskResult> {
        let start_time = Instant::now();
        
        // è®¾ç½®çŠ¶æ€ä¸ºå¿™ç¢Œ
        self.set_status(WorkerHealthStatus::Busy);
        
        // æ‰§è¡Œä»»åŠ¡
        let result = match tokio::time::timeout(
            Duration::from_secs(self.timeout_threshold_secs),
            worker.execute_task(task),
        ).await {
            Ok(Ok(result)) => {
                // æˆåŠŸ
                let duration = start_time.elapsed().as_millis() as f64;
                self.update_stats(true, duration);
                self.set_status(WorkerHealthStatus::Healthy);
                result
            }
            Ok(Err(e)) => {
                // æ‰§è¡Œé”™è¯¯
                let error_type = self.classify_error(&e);
                if self.is_retryable(&error_type) {
                    self.set_status(WorkerHealthStatus::Unhealthy);
                } else {
                    self.set_status(WorkerHealthStatus::Failed);
                }
                self.update_stats(false, 0.0);
                return Err(e);
            }
            Err(_) => {
                // è¶…æ—¶
                tracing::error!(worker_id = %self.worker_id, "ä»»åŠ¡æ‰§è¡Œè¶…æ—¶");
                self.set_status(WorkerHealthStatus::Unhealthy);
                self.update_stats(false, 0.0);
                return Err("ä»»åŠ¡æ‰§è¡Œè¶…æ—¶".into());
            }
        };
        
        Ok(result)
    }

    /// æ›´æ–°ç»Ÿè®¡
    fn update_stats(&self, success: bool, execution_time_ms: f64) {
        self.task_stats.total_tasks += 1;
        if success {
            self.task_stats.successful_tasks += 1;
        } else {
            self.task_stats.failed_tasks += 1;
        }
        
        // æ›´æ–°å¹³å‡æ‰§è¡Œæ—¶é—´ï¼ˆç§»åŠ¨å¹³å‡ï¼‰
        let n = self.task_stats.total_tasks as f64;
        self.task_stats.avg_execution_time_ms =
            (self.task_stats.avg_execution_time_ms * (n - 1.0) + execution_time_ms) / n;
    }

    /// é”™è¯¯åˆ†ç±»
    fn classify_error(&self, error: &Error) -> WorkerErrorType {
        let error_str = error.to_string().to_lowercase();
        
        if error_str.contains("timeout") || error_str.contains("timed out") {
            WorkerErrorType::NetworkTimeout
        } else if error_str.contains("rate limit") || error_str.contains("429") {
            WorkerErrorType::RateLimited
        } else if error_str.contains("unavailable") || error_str.contains("503") {
            WorkerErrorType::TemporaryUnavailable
        } else if error_str.contains("memory") || error_str.contains("quota") {
            WorkerErrorType::InsufficientResources
        } else {
            WorkerErrorType::Unrecoverable
        }
    }

    /// æ£€æŸ¥æ˜¯å¦å¯é‡è¯•
    fn is_retryable(&self, error_type: &WorkerErrorType) -> bool {
        let policy = RetryPolicy {
            max_retries: 3,
            initial_backoff_ms: 1000,
            max_backoff_ms: 60000,
            backoff_multiplier: 2.0,
            retryable_errors: vec![
                WorkerErrorType::NetworkTimeout,
                WorkerErrorType::RateLimited,
                WorkerErrorType::TemporaryUnavailable,
            ],
        };
        
        policy.retryable_errors.contains(error_type)
    }

    /// è·å–çŠ¶æ€
    fn get_status(&self) -> WorkerHealthStatus {
        let status_code = self.status.load(Ordering::Relaxed);
        match status_code {
            0 => WorkerHealthStatus::Initializing,
            1 => WorkerHealthStatus::Healthy,
            2 => WorkerHealthStatus::Busy,
            3 => WorkerHealthStatus::Slow,
            4 => WorkerHealthStatus::Unhealthy,
            5 => WorkerHealthStatus::Failed,
            _ => WorkerHealthStatus::Terminated,
        }
    }

    /// è®¾ç½®çŠ¶æ€
    fn set_status(&self, status: WorkerHealthStatus) {
        self.status.store(status as u8, Ordering::Relaxed);
    }
}

/// å¥åº·æ£€æŸ¥é…ç½®
#[derive(Clone)]
pub struct HealthCheckConfig {
    /// å¿ƒè·³é—´éš”ï¼ˆç§’ï¼‰
    pub heartbeat_interval_secs: u64,
    /// è¶…æ—¶é˜ˆå€¼ï¼ˆç§’ï¼‰
    pub timeout_threshold_secs: u64,
    /// æœ€å¤§é‡è¯•æ¬¡æ•°
    pub max_retry_count: u8,
    /// ç¼“æ…¢é˜ˆå€¼ï¼ˆæ¯«ç§’ï¼‰
    pub slow_threshold_ms: u64,
}

impl Default for HealthCheckConfig {
    fn default() -> Self {
        Self {
            heartbeat_interval_secs: 30,
            timeout_threshold_secs: 300,
            max_retry_count: 3,
            slow_threshold_ms: 10000,
        }
    }
}
```

#### é‡è¯•æœºåˆ¶ç¤ºä¾‹

```
åœºæ™¯ï¼šWorker æ‰§è¡Œä»»åŠ¡å¤±è´¥è‡ªåŠ¨é‡è¯•

Worker A æ‰§è¡Œä»»åŠ¡ "æœç´¢ AI ç¼–ç¨‹åŠ©æ‰‹å¸‚åœºæ•°æ®"

ç¬¬ 1 æ¬¡å°è¯•:
â†’ è°ƒç”¨ web_search API
â†’ ç½‘ç»œè¶…æ—¶ï¼ˆ>30 ç§’ï¼‰
â†’ é”™è¯¯åˆ†ç±»ï¼šNetworkTimeoutï¼ˆå¯é‡è¯•ï¼‰
â†’ çŠ¶æ€è®¾ç½®ä¸º Unhealthy
â†’ ç­‰å¾… 1 ç§’ï¼ˆåˆå§‹é€€é¿ï¼‰

ç¬¬ 2 æ¬¡å°è¯•:
â†’ è°ƒç”¨ web_search API
â†’ API è¿”å› 429 Rate Limited
â†’ é”™è¯¯åˆ†ç±»ï¼šRateLimitedï¼ˆå¯é‡è¯•ï¼‰
â†’ ç­‰å¾… 2 ç§’ï¼ˆæŒ‡æ•°é€€é¿ï¼‰

ç¬¬ 3 æ¬¡å°è¯•:
â†’ è°ƒç”¨ web_search API
â†’ æˆåŠŸè·å–æ•°æ®
â†’ çŠ¶æ€æ¢å¤ä¸º Healthy
â†’ é‡è¯•è®¡æ•°æ¸…é›¶
â†’ ä»»åŠ¡å®Œæˆ

å¦‚æœç¬¬ 3 æ¬¡ä»å¤±è´¥:
â†’ ç­‰å¾… 4 ç§’ï¼ˆç»§ç»­æŒ‡æ•°é€€é¿ï¼‰
â†’ ç¬¬ 4 æ¬¡å°è¯•ï¼ˆè¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•° 3ï¼‰
â†’ çŠ¶æ€è®¾ç½®ä¸º Failed
â†’ å‡çº§é€šçŸ¥å›¢é˜Ÿè´Ÿè´£äºº
â†’ è´Ÿè´£äººå†³å®šï¼šé‡æ–°åˆ†é…ä»»åŠ¡/è°ƒæ•´ç­–ç•¥
```

---

## ä¸ƒã€å®ç°è®¡åˆ’ï¼ˆ10 å‘¨ï¼‰

| é˜¶æ®µ | å†…å®¹ | å·¥æœŸ | é‡Œç¨‹ç¢‘ |
|------|------|------|--------|
| **Phase 1** | CEO Agent æ ¸å¿ƒé€»è¾‘ | 2 å‘¨ | M1: CEO å¯æ™ºèƒ½å†³ç­– |
| **Phase 2** | å›¢é˜Ÿè´Ÿè´£äºº Agent | 2 å‘¨ | M2: å¯ç”Ÿæˆè¯¦ç»†è§’è‰²å®šä¹‰ |
| **Phase 3** | Worker Agent åŠ¨æ€ç”Ÿæˆ | 1 å‘¨ | M3: Worker å®šä¹‰>200 å­— |
| **Phase 4** | èµ„æºç®¡ç†å’Œå®¡æ‰¹ | 1 å‘¨ | M4: é…é¢å®¡æ‰¹æµç¨‹æ­£å¸¸ |
| **Phase 5** | ç”¨æˆ·äº¤äº’ï¼ˆTelegramï¼‰ | 1 å‘¨ | M5: ç”¨æˆ·å¯æŸ¥çœ‹é¡¹ç›® |
| **Phase 6** | æ¨¡å¼åº“ï¼ˆ5 ç§æ¨¡å¼ï¼‰ | 1 å‘¨ | M6: æ¨¡å¼å¯åŠ¨æ€é€‰æ‹© |
| **Phase 7** | é¡¹ç›®çŠ¶æ€è¿½è¸ª | 1 å‘¨ | M7: è¿›åº¦æŠ¥å‘Šæ­£å¸¸ |
| **Phase 8** | æµ‹è¯• + æ–‡æ¡£ | 1 å‘¨ | M8: æµ‹è¯•è¦†ç›–>80% |

**æ€»è®¡**: 10 å‘¨

---

## å…«ã€éªŒæ”¶æ ‡å‡†

### 8.1 åŠŸèƒ½éªŒæ”¶

- [ ] CEO å¯æ™ºèƒ½å†³ç­–ï¼ˆè‡ªå·±åš/å• Agent/é›†ç¾¤ï¼‰
- [ ] å›¢é˜Ÿè´Ÿè´£äººå¯ç”Ÿæˆè¯¦ç»† Worker å®šä¹‰ï¼ˆ>200 å­—ï¼‰
- [ ] Worker å®šä¹‰åŒ…å«ï¼šèŒè´£/æµç¨‹/å·¥å…·/è´¨é‡æ ‡å‡†/åä½œåè®®/å‡çº§æœºåˆ¶
- [ ] å›¢é˜Ÿå¯å‘ CEO ç”³è¯·èµ„æºè°ƒæ•´
- [ ] CEO å¯å®¡æ‰¹èµ„æºç”³è¯·ï¼ˆæ‰¹å‡†/éƒ¨åˆ†æ‰¹å‡†/æ‹’ç»ï¼‰
- [ ] ç”¨æˆ·å¯æŸ¥çœ‹é¡¹ç›®åˆ—è¡¨å’Œè¯¦æƒ…
- [ ] 5 ç§åä½œæ¨¡å¼å¯ç”¨

### 8.2 è´¨é‡éªŒæ”¶

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹è¯•æ–¹æ³• |
|------|--------|---------|
| Worker å®šä¹‰è¯¦ç»†åº¦ | >200 å­— | æ–‡æœ¬é•¿åº¦æ£€æŸ¥ |
| è§’è‰²å®šä¹‰å®Œæ•´æ€§ | 6 ä¸ªéƒ¨åˆ†é½å…¨ | ç»“æ„æ£€æŸ¥ |
| å†³ç­–å‡†ç¡®ç‡ | >80% | äººå·¥è¯„ä¼° |
| ç”¨æˆ·æ»¡æ„åº¦ | >4/5 åˆ† | ç”¨æˆ·æµ‹è¯• |

---

## ä¹ã€æ€»ç»“

### æ ¸å¿ƒä¼˜åŠ¿

| ç‰¹æ€§ | v2.0 | v3.0 ä¼ä¸šç»„ç»‡æ¨¡å¼ |
|------|------|------------------|
| **å†³ç­–æ–¹å¼** | å›ºå®šç›¸ä¼¼åº¦åŒ¹é… | CEO Agent æ™ºèƒ½å†³ç­– |
| **å›¢é˜Ÿè§„æ¨¡** | é¢„å®šä¹‰èŒƒå›´ | å›¢é˜Ÿè´Ÿè´£äººåŠ¨æ€å†³å®š |
| **Agent å®šä¹‰** | ç®€å•æ¨¡æ¿ | LLM ç”Ÿæˆè¯¦ç»†å®šä¹‰ï¼ˆ>200 å­—ï¼‰ |
| **ç®€å•ä»»åŠ¡** | ä¹Ÿå¯åŠ¨é›†ç¾¤ | CEO å†³ç­–ï¼šè‡ªå·±åš/å• Agent/é›†ç¾¤ |
| **èµ„æºç®¡ç†** | å›ºå®šé…é¢ | å¯ç”³è¯·è°ƒæ•´ï¼ŒCEO å®¡æ‰¹ |
| **ç”¨æˆ·äº¤äº’** | æŠ€æœ¯è§†è§’ | ä¼ä¸šç»„ç»‡è§†è§’ï¼ˆè‘£äº‹é•¿â†’CEOï¼‰ |

### ä¼ä¸šç»„ç»‡ç±»æ¯”

```
ç°å®ä¼ä¸š              ZeroClaw
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æŠ•èµ„äºº/è‘£äº‹é•¿    â†’    ç”¨æˆ·
CEO              â†’    CEO Agentï¼ˆå®ä¾‹ç®¡ç†ï¼‰
é¡¹ç›®è´Ÿè´£äºº       â†’    å›¢é˜Ÿè´Ÿè´£äºº Agent
éƒ¨é—¨å‘˜å·¥         â†’    Worker Agent
å…¬å¸             â†’    ZeroClaw å®ä¾‹
é¡¹ç›®             â†’    é¡¹ç›®å›¢é˜Ÿ
èµ„æºé¢„ç®—         â†’    Token/æˆæœ¬é…é¢
```

**v3.0 æ–¹æ¡ˆå®ç°äº†çœŸæ­£çš„æ™ºèƒ½å†³ç­–å’ŒåŠ¨æ€ç”Ÿæˆï¼Œè®© AI åƒä¼ä¸šä¸€æ ·é«˜æ•ˆåä½œï¼**

---

**å®¡æ‰¹çŠ¶æ€**: å¾…å®¡æ‰¹  
**è´Ÿè´£äºº**: å¾…å®š  
**æœ€åæ›´æ–°**: 2026 å¹´ 2 æœˆ 28 æ—¥
